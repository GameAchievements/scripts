(()=>{var v=e=>{let o=t=>`0${t}`.slice(-2),a=new Date(e);return`${a.getFullYear()} . ${o(a.getMonth()+1)} . ${o(a.getDate())}`};var R=e=>{switch(e){case"playstation":return 1;case"xbox":return 2;default:return 3}},N=e=>{switch(e.toLowerCase()){case"playstation":return"psn";case"xbox":return"xbox";case"steam":return"steam";default:return"ga"}};var M=e=>e?.length?e.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):e;function V(e,o){if(e.length<=o)return e;let a=e.substr(0,o);return a=a.substr(0,Math.min(a.length,a.lastIndexOf(" "))),`${a} ...`}function B(e){return e?e.toLowerCase().replace(/\b\w/g,o=>o.toUpperCase()):""}var C=(e,o,a="success",t=()=>{},r=4e3)=>{e.addClass(`${a}-message`).css("display","flex"),$("div:first-child",e).text(o),setTimeout(()=>{e.removeClass(`${a}-message`).hide(),t()},r)};var G=()=>{location.hash?.length>0&&$([document.documentElement,document.body]).animate({scrollTop:$(location.hash).offset().top-50},2e3)};var y=e=>e?.includes("steamstatic")||e?.includes("steampowered"),H=e=>e?.includes("images-eds.xboxlive.com");var K=e=>{if(e<25)return"common";if(e<50)return"rare";if(e<75)return"very-rare";if(e>=75)return"ultra-rare"};var z=(e,o,a,t=!1)=>{e.append(o).children().last().removeClass(["bg-light","bg-dark","locked","unlocked"]).addClass(`bg-${a%2>0?"light":"dark"}`).addClass(`${t?"unlocked":"locked"}`)};var x=(e,o,a=".gas-list-entry")=>{let t=o,r={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return r.ps.rgx.test(e)&&(t=$(".gas-platform-psn",t).css("display","inherit").parents(a).prop("outerHTML")),r.steam.rgx.test(e)&&(t=$(".gas-platform-steam",t).css("display","inherit").parents(a).prop("outerHTML")),r.xbox.rgx.test(e)&&(t=$(".gas-platform-xbox",t).css("display","inherit").parents(a).prop("outerHTML")),t};var E=(e,o,a=".gas-list-entry")=>{let t=o,r={ps:{rgx:/ps/gi},xbox:{rgx:/xbox/gi},pc:{rgx:/steam|pc|windows|mac|linux/gi}};return r.ps.rgx.test(e)?(t=$(".gas-console-tags",t).children(":not(.console-playstation)").hide().parents(a).prop("outerHTML"),t=t.replaceAll("PS5",e)):r.pc.rgx.test(e)?(t=$(".gas-console-tags",t).children(":not(.console-pc)").hide().parents(a).prop("outerHTML"),t=t.replaceAll("PC",e)):r.xbox.rgx.test(e)&&(t=$(".gas-console-tags",t).children(":not(.console-xbox)").hide().parents(a).prop("outerHTML"),t=t.replaceAll("XBOX 360",e)),t};var J=(e,o,a=".gh-row")=>{let t=o;return t=$(".total-achievements-wrapper",t).children(`:not(.total-achievements-${e.userAchievementsCount===e.achievementsCount?"completed":"uncompleted"})`).hide().parents(a).prop("outerHTML"),t=t.replaceAll("{|userAchievementsCount|}/{|achievementsCount|}",`${Math.round(e.userAchievementsCount||0)}/${Math.round(e.achievementsCount||0)}`),t};var W=(e,o,a=".gh-row")=>{let t=o;return t=$(".completion-status-wrapper",t).children(`:not(.${e===100?"unlocked":"locked"}-status)`).hide().parents(a).prop("outerHTML"),t=t.replaceAll("{|completion|}",Math.round(e||0)),t};var A=(e,o,a=".gas-list-entry")=>e.removeAttr("srcset").removeAttr("sizes").attr("src",o).parents(a).prop("outerHTML");function le(e){switch(e){case 1:return"#FF6C6C";case 2:return"#FF876C";case 3:return"#FFB36C";case 4:return"#FFD66C";case 5:return"#D0FF6C";case 6:return"#6CFFCA";case 7:return"#69E4FF";case 8:return"#99A3FF";case 9:return"#C699FF";case 10:return"#FFA0EA";default:return"#5663BA"}}function ce(e=""){return`<svg ${e} viewBox="0 0 400 283" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M396.063 200.058C387.286 177.198 388.232 171.375 363.69 113.777C342.879 64.745 324.486 39.1518 302.256 32.5827V16.449C302.256 7.35738 294.899 0 285.807 0H260.74C251.648 0 244.291 7.35738 244.291 16.449V30.7959H155.687V16.449C155.687 7.35738 148.277 0 139.238 0H114.17C105.079 0 97.7212 7.35738 97.7212 16.449V32.5827C75.4388 39.1518 57.098 64.745 36.2345 113.777C11.6925 171.427 12.5859 177.25 3.80958 200.058C-4.91416 222.919 0.341103 257.656 30.0859 275.104C59.8833 292.499 89.6806 279.36 114.17 246.568C138.712 213.775 148.329 215.414 169.35 215.414H230.679C251.701 215.414 261.265 213.775 285.807 246.568C310.297 279.36 340.094 292.446 369.891 275.104C399.636 257.709 404.944 222.919 396.168 200.058H396.063Z" />
    </svg>`}function D(e){return ce(`class="bg-review-score" fill="${le(e)}"`)}function pe({listData:e,elemId:o,numKeysToReplace:a,textKeysToReplace:t,tabCounts:r,tabMatcher:f}){let c=$(`${o} .gas-list-tabs`);console.info(`=== ${o} results ===`,e);let p=c.prop("outerHTML");(!r||Object.keys(r).length<1)&&(f="platform",r={allCnt:e.length,playstationCnt:e.filter(i=>i[f].toLowerCase()==="playstation")?.length,xboxCnt:e.filter(i=>i[f].toLowerCase()==="xbox")?.length,steamCnt:e.filter(i=>i[f].toLowerCase()==="steam")?.length});let n=Object.keys(r);for(let i of n)p=p.replaceAll(`{|${i}|}`,r[i])||"0";c.prop("outerHTML",p);for(let i of n){let l=i.slice(0,i.indexOf("Cnt")),s=$(`${o} .gas-list-${l}`),g=$(".gas-list-empty",s);if(r[i]>0){let u=s.children().first(),m=$(".gas-list-entry",s).first();m.show(),p=m.prop("outerHTML"),s.html(u).append(m),m.hide(),(l==="all"?e:e.filter(h=>h[f]?.toLowerCase()===l)).forEach((h,F)=>{let d=p;for(let[w,b]of Object.entries(h)){let I=h.imageURL||h.iconURL;if(I?.length&&!y(I)){let T=$(".gas-list-entry-cover",d);T?.length&&(d=A(T,I)||d)}if(t.includes(w))d=d.replaceAll(`{|${w}|}`,(w.endsWith("At")?v(b):M(b))||"");else if(a.includes(w))d=d.replaceAll(`{|${w}|}`,Math.round(b||0));else if(w==="rating"){d=d.replaceAll(`{|${w}|}`,Math.round(b||0));let T=$(".gas-list-entry-rating",d);T.length&&(d=T.prepend(D(b)).parents(".gas-list-entry").prop("outerHTML"))}else if(w==="platform")d=x(b,d);else if(w==="rarity"){let T=K(b);d=d.replaceAll(`{|${w}|}`,B(T.replace("-"," "))),d=$(".gas-rarity-tag",d).removeClass("gas-rarity-tag").addClass(`gas-rarity-tag-${T}`).children(".p1").addClass(T).parents(".gas-list-entry").prop("outerHTML")}}s.append(d).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${F%2>0?"light":"dark"}`)})}else s.html(g),g.show()}}async function Q({elemIdPrefix:e,profileId:o,fetchURLPrefix:a},{listName:t,numKeysToReplace:r,textKeysToReplace:f,tabs:c=[],tabMatcher:p}){let n=`${e}-${t}`,i;if(o?.length){let u=`${a}/id/${o}/${t}`;i=await fetch(u)}else userAuth0Data?.sub?.length&&(i=await fetch(`${a}/my/${t}`,{headers:{Authorization:`Bearer ${token}`}}));let l=await i.json(),s=l?.results;if(l?.count){let u;if(Array.isArray(c)){u={};for(let m of c)u[`${m}Cnt`]=m==="all"?s.length:s.filter(h=>h[p]?.toLowerCase()===m)?.length}switch(t){case"reviews":$(".gas-count-reviews").each((m,h)=>{$(h).text($(h).text().replace("{|reviewsCnt|}",s.length)),m>0&&$(h).text($(h).text().replace(`{|${c[m]}ReviewsCnt|}`,u[`${c[m]}Cnt`]))});break;default:break}pe({listData:s,elemId:n,numKeysToReplace:r,textKeysToReplace:f,tabCounts:u,tabMatcher:p});return}let g=$(".gas-list-empty").first().clone();$(`${n}`).html(g),g.show()}async function q(e,o,a){await Q({elemIdPrefix:e,profileId:o,fetchURLPrefix:a},{listName:"achievements",numKeysToReplace:["id","score","achieversCount","gAPoints"],textKeysToReplace:["name","description","updatedAt"]})}async function Y(e,o){if(confirm("This will unlink all your platforms from your profile and remove your profile. Are you sure?")){let a=`https://${e}/api/user`,t=await fetch(a,{method:"DELETE",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}}),r=$(`${o}-msg-delete`);if($(this).hide(),t.status!==204){C(r,"Account could not be deleted\u2026 Please try later.","error",()=>{$(this).show()});return}C(r,"Account is successfully being deleted\u2026 Logging out.","success",logout)}}function Z({listData:e,elemId:o,numKeysToReplace:a,textKeysToReplace:t}){console.info(`=== ${o} results ===`,e);let r=$(o).prop("outerHTML"),f=$(`${o} .xbox-achievement-list`),c=$(`${o} .empty-state`),p=$(".gh-row",f).first();p.show(),r=p.prop("outerHTML"),p.hide(),e?.length&&r?.length?(f.html(p),e.forEach((n,i)=>{let l=r;l=l.replaceAll("{|idx|}",i+1);for(let[s,g]of Object.entries(n)){if(n.gameIconURL?.length&&!y(n.gameIconURL)){let u=$(".gas-list-entry-cover-game",l);u?.length&&(l=A(u,n.gameIconURL,".gh-row")||l)}if((n.iconURL?.length||n.imageURL?.length)&&!H(n.imageURL)&&!y(n.imageURL)&&!y(n.iconURL)){let u=$(".gas-list-entry-cover",l);u?.length&&(l=o.includes("list-games")?u.css("background-image",`url(${n.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):A(u,n.iconURL||n.imageURL,".gh-row")||l)}if(t.includes(s))l=l.replaceAll(`{|${s}|}`,(s.endsWith("At")?v(g):M(g))||"");else if(a.includes(s))l=l.replaceAll(`{|${s}|}`,Math.round(g||0));else if(s==="userAchievementsCount")l=J({userAchievementsCount:n.userAchievementsCount,achievementsCount:n.achievementsCount},l,".gh-row");else if(s==="completion")l=W(g,l,".gh-row");else if(s==="importedFromPlatform"||s==="platform"||s==="platforms")l=x(g,l,".gh-row");else if(s==="consoles")for(let u of g)l=E(u,l,".gh-row")}z(f,l,i,n?.completion===100)})):(e?.length&&!r?.length&&console.error(`${o} template issue (missing a '.gas-' class?)`),$(o).html(c),c.show()),f.css("display","flex")}async function _(e,o,a){let t;a?.length?t=await fetch(`https://${o}/api/id/${a}/games?perPage=25`):userAuth0Data?.sub?.length&&(t=await fetch(`https://${o}/api/profile/my/games?perPage=25`,{headers:{Authorization:`Bearer ${token}`}}));let f=(await t.json())?.results,c=`${e}-games-played`;Z({listData:f,elemId:c,numKeysToReplace:["id","gaUserScore","gaTotalScore"],textKeysToReplace:["name","description"]}),$(`${c} .ga-loader-container`).hide()}function ee(e,o){let a=o,t=$(".gas-list-entry-cover-game",a);return t?.length&&(a=A(t,e)||a),a}function S({listData:e,elemId:o,numKeysToReplace:a,textKeysToReplace:t,drillDown:r={key:null,keysToReplace:null}}){console.info(`=== ${o} results ===`,e);let f=$(o).prop("outerHTML"),c=$(`${o} .gas-list`),p=$(`${o} .gas-list-empty`),n=$(".gas-list-entry",c).first();n.show(),f=n.prop("outerHTML"),n.hide(),e?.length&&f?.length?(c.html(n),e.forEach((i,l)=>{let s=f;s=s.replaceAll("{|idx|}",l+1);for(let[g,u]of Object.entries(i)){if(i.gameIconURL?.length&&!y(i.gameIconURL)&&(s=ee(i.gameIconURL,s)),(i.iconURL?.length||i.imageURL?.length)&&!H(i.imageURL)&&!y(i.imageURL)&&!y(i.iconURL)){let m=$(".gas-list-entry-cover",s);m?.length&&(s=o.includes("list-games")?m.css("background-image",`url(${i.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):A(m,i.iconURL||i.imageURL)||s)}if(t.includes(g))s=s.replaceAll(`{|${g}|}`,(g.endsWith("At")?v(u):M(u))||"");else if(a.includes(g))s=s.replaceAll(`{|${g}|}`,Math.round(u||0));else if(g==="lastPlayed")s=s.replaceAll(`{|${g}|}`,v(u));else if(g==="content")s=s.replaceAll(`{|${g}|}`,V(u,160));else if(g==="importedFromPlatform"||g==="platform"||g==="platforms")s=x(u,s);else if(g==="consoles"&&!u.includes("PC")){let m=$(`.gas-tags-${g}`,s);m?.length&&(s=m.html(u.map(h=>`<div class="console-tag" title="${h}"><div class="gas-text-overflow">${h}</div></div>`).join(`
`)).parents(".gas-list-entry").prop("outerHTML"))}else if(r.key&&g===r.key)for(let m of r.keysToReplace)if(m==="platform")s=x(u[m],s);else if(m==="consoles"&&!u[m].includes("PC")){let h=$(`.gas-tags-${m}`,s);h?.length&&(s=h.html(u[m].map(F=>`<div class="console-tag" title="${F}"><div class="gas-text-overflow">${F}</div></div>`).join(`
`)).parents(".gas-list-entry").prop("outerHTML"))}else m==="gameIconURL"?s=ee(u[m],s):typeof u[m]=="string"?s=s.replaceAll(`{|${m}|}`,u[m]):s=s.replaceAll(`{|${m}|}`,Math.round(u[m]||0));else if(g==="rating"){s=s.replaceAll(`{|${g}|}`,Math.round(u||0));let m=$(".gas-list-entry-rating",s);m.length&&(s=m.prepend(D(u)).parents(".gas-list-entry").prop("outerHTML"))}}c.append(s)})):(e?.length&&!f?.length&&console.error(`${o} template issue (missing a '.gas-' class?)`),$(o).html(p),p.show()),c.css("display","flex")}async function te(e,o,a){let t;a?.length?t=await fetch(`https://${o}/api/id/${a}/guides?perPage=5`):userAuth0Data?.sub?.length&&(t=await fetch(`https://${o}/api/profile/my/guides?perPage=5`,{headers:{Authorization:`Bearer ${token}`}}));let f=(await t.json())?.results,c=`${e}-list-guides`;S({listData:f,elemId:c,numKeysToReplace:["id","commentsCount","likesCount","viewsCount"],textKeysToReplace:["name","author","achievementDescription","profileId"]}),$(`${c} .ga-loader-container`).hide()}async function ae(e,o,a){let t;a?.length?t=await fetch(`https://${o}/api/id/${a}/reviews?perPage=5`):userAuth0Data?.sub?.length&&(t=await fetch(`https://${o}/api/profile/my/reviews?perPage=5`,{headers:{Authorization:`Bearer ${token}`}}));let f=(await t.json())?.results,c=`${e}-list-reviews`;S({listData:f,elemId:c,numKeysToReplace:["id"],textKeysToReplace:["name","gameName","achievementDescription","profileId","updatedAt"]}),$(`${c} .ga-loader-container`).hide()}async function j({platform:e,accountId:o,accountName:a},t,r,f){let c=r,p=e.toLowerCase();c=c.filter(i=>i!==p);let n=$(`#ga-pa-linked-${p}`);$(".gas-pa-name",n).text(o).attr("title",`name: ${a}`),n.show(),$(".gas-unlink-pa-btn",n).click(async i=>{i.preventDefault(),confirm(`Your ${e} account will no longer belong to your profile. Are you sure?`)&&(await fetch(`${t}/unlink-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platform:R(p)})}),n.children().hide(),n.append(`<p id="ga-unlink-message" class="platform-heading">Unlinking your ${p} account\u2026</p>`).css({flexGrow:1,maxWidth:"25%",justifyContent:"center"}),setTimeout(()=>{n.hide(),n.children().show(),$("#ga-unlink-message",n).remove(),O(p),sessionStorage.removeItem("prof"),location.reload()},f))})}async function O(e,o,a){let t=$(`#ga-pa-to-link-${e}`);t.show();let r=$("input[name=external]",t),f=$("input[type=submit]",t),c=$(".gas-link-pa-form",t),p=$(".gas-link-pa-error",t);f.click(async n=>{if(n.preventDefault(),!r.val()?.length){c.hide(),p.css("display","flex"),console.error("Please fill-in the input field with an id"),setTimeout(()=>{p.hide(),c.css("display","flex")},a);return}$("input",t).attr("disabled",!0);let i={platform:R(e),external:r.val()},l=await fetch(`${o}/link-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)}),s=await l.json();if(l.status!==201){p.css("display","flex"),c.hide(),console.error(s?.message),setTimeout(()=>{p.hide(),$("input",t).attr("disabled",!1),c.css("display","flex")},a);return}c.hide(),$(".gas-link-pa-success",t).attr("title",s?.message).css("display","flex"),setTimeout(()=>{t.hide(),j({platform:e,accountId:s?.platformAccount?.playerId,accountName:s?.platformAccount?.playerName}),sessionStorage.removeItem("prof"),location.reload()},a)})}async function oe(e,o,a){let t=$(`${o}-msg-avatar`);e.length||C(t,"Please link first a platform account in order to choose your avatar.","unstyled",()=>{t.css("display","flex")}),e.map(({platform:r})=>{let f=r.toLowerCase();$(`${o}-btn-avatar-${f}`).show().click(async function(){let c=await fetch(`${a}/avatar`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platformId:R(f)})});if(c.status!==201){C(t,"Oops! Issue changing avatar\u2026 Please try later.","error");return}let p=await c.json();p.imageURL?.length&&($(".gas-profile-avatar").removeAttr("srcset").removeAttr("sizes").attr("src",p.imageURL),C(t,"Avatar successfully changed!"))})})}var X=4e3,L="#gas-profile",se=["playstation","xbox","steam"];function me(e,o=[]){$(`${L}-pa-code-copied-msg`).hide(),userProfileData.platformVerifierCode?.length?($(`${L}-pa-code`).text(userProfileData.platformVerifierCode),$(`${L}-pa-code-btn`).on("click",async()=>{await navigator.clipboard.writeText(userProfileData.platformVerifierCode),$(`${L}-pa-code-copied-msg`).show(),setTimeout(()=>{$(`${L}-pa-code-copied-msg`).hide()},X)})):$(`${L}-pa-code-btn`).hide();for(let t of o)j(t,e,se,X);let a=se.filter(t=>!o.map(({platform:r})=>r.toLowerCase()).includes(t));for(let t of a)O(t,e,X)}function ue(e,o){let a=`${L}-details`,t=$(`${a}`).prop("outerHTML");console.info(`=== ${a} ===`,e);let r=["name","description","guidesCount","gamesCount","completedCount","completion","achievedCount"];for(let[p,n]of Object.entries(e))if(r.includes(p))t=t.replaceAll(`{|${p}|}`,n);else if(p==="gaPoints")t=t.replaceAll("{|gaPoints|}",e.platforms.find(i=>i.platform==="GA")?.gaUserScore??0);else if(p==="platforms"){let i=["accountName","totalGames","completion","ranking"];for(let l of n){for(let s of i)t=t.replaceAll(`{|${N(l.platform)}-${s}|}`,l[s]??"N.A");t=x(l.platform,t,a)}}if($(`${a}`).prop("outerHTML",t),!userAuth0Data?.sub?.length)return;if(oe(e.platforms,L,o),me(o,e.platforms),e.role?.length){let p=e.role.toLowerCase()==="regular";if($(`.gas-role${p?"":"-non"}-regular`).show(),!p){let n=$("#gas-ads-toggle");userProfileData.adsOff&&n.prop("checked",!0),n.on("change",async i=>{let l=`${o}/ads`,s=await fetch(l,{method:"POST",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}});s.status!==201&&n.prop("checked",userProfileData.adsOff),resData=await s.json(),s.status===201&&(userProfileData.adsOff=!userProfileData.adsOff,sessionStorage.setItem("prof",JSON.stringify(userProfileData)),resData?.message?.includes("deactivated")?$(".ads-section").hide():$(".ads-section").show());let g=s.status===201?"success":"error";displayMessage($(`#gas-ads-form .gas-form-${g}`),resData?.message,g)})}}let f=$(".community-div .heading-description-wrapper"),c=f.prop("outerHTML").replaceAll("{|name|}",e.name);f=f.prop("outerHTML",c)}async function re(e,o){let a;if(o?.length){let t=`${e}/id/${o}`,r=await fetch(t);if(r.status!==200)return!1;a=await r.json()}else if(userProfileData)a=userProfileData;else return!1;return a.visible?(a.id?.length>0&&(document.title=`${a.name?.length?a.name:a.id} | ${document.title}`,ue(a,e)),!0):!1}var U=document.querySelector("meta[name=domain]")?.content,fe=new URLSearchParams(location.search),P=fe.get("id"),k="#gas-profile",ne=`https://${U}/api/profile`,ge="/";$(".ga-loader-container").show();$(`.action-message-wrapper,#ga-sections-container,.gas-role-non-regular,.gas-role-regular,[id^=ga-pa-linked],[id^=ga-pa-to-link],[id^=${k.slice(1)}-btn-avatar],[id^=${k.slice(1)}-msg]`).hide();$(async()=>{if(await auth0Bootstrap(),P?.length&&$("#user-settings, #ga-user-settings-tab").hide(),await re(ne,P)){await Promise.all([await _(k,U,P),await q(k,P,ne),await te(k,U,P),await ae(k,U,P)]),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$(`${k}-btn-delete`).on("click",()=>Y(U,k)),G(),$("#gas-wf-tab-activator").click();return}if(!P?.length&&login){login();return}location.replace(ge)});})();
