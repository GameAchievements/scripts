(()=>{var A=e=>{let o=t=>`0${t}`.slice(-2),a=new Date(e);return`${a.getFullYear()} . ${o(a.getMonth()+1)} . ${o(a.getDate())}`};var j=e=>{switch(e){case"playstation":return 1;case"xbox":return 2;default:return 3}},I=e=>{switch(e.toLowerCase()){case"playstation":return"psn";case"xbox":return"xbox";case"steam":return"steam";default:return"ga"}};var b=e=>e?.length?e.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):e;function N(e,o){if(e.length<=o)return e;let a=e.substr(0,o);return a=a.substr(0,Math.min(a.length,a.lastIndexOf(" "))),`${a} ...`}var v=(e,o,a="success",t=()=>{},r=4e3)=>{e.addClass(`${a}-message`).css("display","flex"),$("div:first-child",e).text(o),setTimeout(()=>{e.removeClass(`${a}-message`).hide(),t()},r)};var V=()=>{location.hash?.length>0&&$([document.documentElement,document.body]).animate({scrollTop:$(location.hash).offset().top-50},2e3)};var y=e=>e?.includes("steamstatic")||e?.includes("steampowered"),P=e=>e?.includes("images-eds.xboxlive.com");var B=e=>{if(e<25)return"common";if(e<50)return"rare";if(e<75)return"very-rare";if(e>=75)return"ultra-rare"};var G=(e,o,a,t=!1)=>{e.append(o).children().last().removeClass(["bg-light","bg-dark","locked","unlocked"]).addClass(`bg-${a%2>0?"light":"dark"}`).addClass(`${t?"unlocked":"locked"}`)};var x=(e,o,a=".gas-list-entry")=>{let t=o,r={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return r.ps.rgx.test(e)&&(t=$(".gas-platform-psn",t).css("display","inherit").parents(a).prop("outerHTML")),r.steam.rgx.test(e)&&(t=$(".gas-platform-steam",t).css("display","inherit").parents(a).prop("outerHTML")),r.xbox.rgx.test(e)&&(t=$(".gas-platform-xbox",t).css("display","inherit").parents(a).prop("outerHTML")),t};var D=(e,o,a=".gas-list-entry")=>{let t=o,r={ps:{rgx:/ps/gi},xbox:{rgx:/xbox/gi},pc:{rgx:/steam|pc|windows|mac|linux/gi}};return r.ps.rgx.test(e)?(t=$(".gas-console-tags",t).children(":not(.console-playstation)").hide().parents(a).prop("outerHTML"),t=t.replaceAll("PS5",e)):r.pc.rgx.test(e)?(t=$(".gas-console-tags",t).children(":not(.console-pc)").hide().parents(a).prop("outerHTML"),t=t.replaceAll("PC",e)):r.xbox.rgx.test(e)&&(t=$(".gas-console-tags",t).children(":not(.console-xbox)").hide().parents(a).prop("outerHTML"),t=t.replaceAll("XBOX 360",e)),t};var K=(e,o,a=".gh-row")=>{let t=o;return t=$(".total-achievements-wrapper",t).children(`:not(.total-achievements-${e.userAchievementsCount===e.achievementsCount?"completed":"uncompleted"})`).hide().parents(a).prop("outerHTML"),t=t.replaceAll("{|userAchievementsCount|}/{|achievementsCount|}",`${Math.round(e.userAchievementsCount||0)}/${Math.round(e.achievementsCount||0)}`),t};var z=(e,o,a=".gh-row")=>{let t=o;return t=$(".completion-status-wrapper",t).children(`:not(.${e===100?"unlocked":"locked"}-status)`).hide().parents(a).prop("outerHTML"),t=t.replaceAll("{|completion|}",Math.round(e||0)),t};var C=(e,o,a=".gas-list-entry")=>e.removeAttr("srcset").removeAttr("sizes").attr("src",o).parents(a).prop("outerHTML");function ie(e){switch(e){case 1:return"#FF6C6C";case 2:return"#FF876C";case 3:return"#FFB36C";case 4:return"#FFD66C";case 5:return"#D0FF6C";case 6:return"#6CFFCA";case 7:return"#69E4FF";case 8:return"#99A3FF";case 9:return"#C699FF";case 10:return"#FFA0EA";default:return"#5663BA"}}function le(e=""){return`<svg ${e} viewBox="0 0 400 283" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M396.063 200.058C387.286 177.198 388.232 171.375 363.69 113.777C342.879 64.745 324.486 39.1518 302.256 32.5827V16.449C302.256 7.35738 294.899 0 285.807 0H260.74C251.648 0 244.291 7.35738 244.291 16.449V30.7959H155.687V16.449C155.687 7.35738 148.277 0 139.238 0H114.17C105.079 0 97.7212 7.35738 97.7212 16.449V32.5827C75.4388 39.1518 57.098 64.745 36.2345 113.777C11.6925 171.427 12.5859 177.25 3.80958 200.058C-4.91416 222.919 0.341103 257.656 30.0859 275.104C59.8833 292.499 89.6806 279.36 114.17 246.568C138.712 213.775 148.329 215.414 169.35 215.414H230.679C251.701 215.414 261.265 213.775 285.807 246.568C310.297 279.36 340.094 292.446 369.891 275.104C399.636 257.709 404.944 222.919 396.168 200.058H396.063Z" />
    </svg>`}function H(e){return le(`class="bg-review-score" fill="${ie(e)}"`)}function ce({listData:e,elemId:o,numKeysToReplace:a,textKeysToReplace:t,tabCounts:r,tabMatcher:m}){let c=$(`${o} .gas-list-tabs`);console.info(`=== ${o} results ===`,e);let p=c.prop("outerHTML");(!r||Object.keys(r).length<1)&&(m="platform",r={allCnt:e.length,playstationCnt:e.filter(i=>i[m].toLowerCase()==="playstation")?.length,xboxCnt:e.filter(i=>i[m].toLowerCase()==="xbox")?.length,steamCnt:e.filter(i=>i[m].toLowerCase()==="steam")?.length});let n=Object.keys(r);for(let i of n)p=p.replaceAll(`{|${i}|}`,r[i])||"0";c.prop("outerHTML",p);for(let i of n){let l=i.slice(0,i.indexOf("Cnt")),s=$(`${o} .gas-list-${l}`),f=$(".gas-list-empty",s);if(r[i]>0){let u=s.children().first(),g=$(".gas-list-entry",s).first();g.show(),p=g.prop("outerHTML"),s.html(u).append(g),g.hide(),(l==="all"?e:e.filter(d=>d[m]?.toLowerCase()===l)).forEach((d,re)=>{let h=p;for(let[w,k]of Object.entries(d)){let O=d.imageURL||d.iconURL;if(O?.length&&!y(O)){let T=$(".gas-list-entry-cover",h);T?.length&&(h=C(T,O)||h)}if(t.includes(w))h=h.replaceAll(`{|${w}|}`,(w.endsWith("At")?A(k):b(k))||"");else if(a.includes(w))h=h.replaceAll(`{|${w}|}`,Math.round(k||0));else if(w==="rating"){h=h.replaceAll(`{|${w}|}`,Math.round(k||0));let T=$(".gas-list-entry-rating",h);T.length&&(h=T.prepend(H(k)).parents(".gas-list-entry").prop("outerHTML"))}else if(w==="platform")h=x(k,h);else if(w==="rarity"){let T=B(k);h=h.replaceAll(`{|${w}|}`,T.replace("-"," ")),h=$(".gas-rarity-tag",h).removeClass("gas-rarity-tag").addClass(`gas-rarity-tag-${T}`).children(".p1").addClass(T).parents(".gas-list-entry").prop("outerHTML")}}s.append(h).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${re%2>0?"light":"dark"}`)})}else s.html(f),f.show()}}async function J({elemIdPrefix:e,profileId:o,fetchURLPrefix:a},{listName:t,numKeysToReplace:r,textKeysToReplace:m,tabs:c=[],tabMatcher:p}){let n=`${e}-${t}`,i;if(o?.length){let u=`${a}/id/${o}/${t}`;i=await fetch(u)}else userAuth0Data?.sub?.length&&(i=await fetch(`${a}/my/${t}`,{headers:{Authorization:`Bearer ${token}`}}));let l=await i.json(),s=l?.results;if(l?.count){let u;if(Array.isArray(c)){u={};for(let g of c)u[`${g}Cnt`]=g==="all"?s.length:s.filter(d=>d[p]?.toLowerCase()===g)?.length}switch(t){case"reviews":$(".gas-count-reviews").each((g,d)=>{$(d).text($(d).text().replace("{|reviewsCnt|}",s.length)),g>0&&$(d).text($(d).text().replace(`{|${c[g]}ReviewsCnt|}`,u[`${c[g]}Cnt`]))});break;default:break}ce({listData:s,elemId:n,numKeysToReplace:r,textKeysToReplace:m,tabCounts:u,tabMatcher:p});return}let f=$(".gas-list-empty").first().clone();$(`${n}`).html(f),f.show()}async function W(e,o,a){await J({elemIdPrefix:e,profileId:o,fetchURLPrefix:a},{listName:"achievements",numKeysToReplace:["id","score","achieversCount","gAPoints"],textKeysToReplace:["name","description","updatedAt"]})}async function X(){if(confirm("This will unlink all your platforms from your profile and remove your profile. Are you sure?")){let e=`https://${apiDomain}/api/user`,o=await fetch(e,{method:"DELETE",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}}),a=$(`${elemIdPrefix}-msg-delete`);if($(this).hide(),o.status!==204){v(a,"Account could not be deleted\u2026 Please try later.","error",()=>{$(this).show()});return}v(a,"Account is successfully being deleted\u2026 Logging out.","success",logout)}}function Q({listData:e,elemId:o,numKeysToReplace:a,textKeysToReplace:t}){console.info(`=== ${o} results ===`,e);let r=$(o).prop("outerHTML"),m=$(`${o} .xbox-achievement-list`),c=$(`${o} .empty-state`),p=$(".gh-row",m).first();p.show(),r=p.prop("outerHTML"),p.hide(),e?.length&&r?.length?(m.html(p),e.forEach((n,i)=>{let l=r;l=l.replaceAll("{|idx|}",i+1);for(let[s,f]of Object.entries(n)){if(n.gameIconURL?.length&&!y(n.gameIconURL)){let u=$(".gas-list-entry-cover-game",l);u?.length&&(l=C(u,n.gameIconURL,".gh-row")||l)}if((n.iconURL?.length||n.imageURL?.length)&&!P(n.imageURL)&&!y(n.imageURL)&&!y(n.iconURL)){let u=$(".gas-list-entry-cover",l);u?.length&&(l=o.includes("list-games")?u.css("background-image",`url(${n.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):C(u,n.iconURL||n.imageURL,".gh-row")||l)}if(t.includes(s))l=l.replaceAll(`{|${s}|}`,(s.endsWith("At")?A(f):b(f))||"");else if(a.includes(s))l=l.replaceAll(`{|${s}|}`,Math.round(f||0));else if(s==="userAchievementsCount")l=K({userAchievementsCount:n.userAchievementsCount,achievementsCount:n.achievementsCount},l,".gh-row");else if(s==="completion")l=z(f,l,".gh-row");else if(s==="importedFromPlatform"||s==="platform"||s==="platforms")l=x(f,l,".gh-row");else if(s==="consoles")for(let u of f)l=D(u,l,".gh-row")}G(m,l,i,n?.completion===100)})):(e?.length&&!r?.length&&console.error(`${o} template issue (missing a '.gas-' class?)`),$(o).html(c),c.show()),m.css("display","flex")}async function q(e,o,a){let t;a?.length?t=await fetch(`https://${o}/api/id/${a}/games?perPage=25`):userAuth0Data?.sub?.length&&(t=await fetch(`https://${o}/api/profile/my/games?perPage=25`,{headers:{Authorization:`Bearer ${token}`}}));let m=(await t.json())?.results,c=`${e}-games-played`;Q({listData:m,elemId:c,numKeysToReplace:["id","gaUserScore","gaTotalScore"],textKeysToReplace:["name","description"]}),$(`${c} .ga-loader-container`).hide()}function Y(e,o){let a=o,t=$(".gas-list-entry-cover-game",a);return t?.length&&(a=C(t,e)||a),a}function U({listData:e,elemId:o,numKeysToReplace:a,textKeysToReplace:t,drillDown:r={key:null,keysToReplace:null}}){console.info(`=== ${o} results ===`,e);let m=$(o).prop("outerHTML"),c=$(`${o} .gas-list`),p=$(`${o} .gas-list-empty`),n=$(".gas-list-entry",c).first();n.show(),m=n.prop("outerHTML"),n.hide(),e?.length&&m?.length?(c.html(n),e.forEach((i,l)=>{let s=m;s=s.replaceAll("{|idx|}",l+1);for(let[f,u]of Object.entries(i)){if(i.gameIconURL?.length&&!y(i.gameIconURL)&&(s=Y(i.gameIconURL,s)),(i.iconURL?.length||i.imageURL?.length)&&!P(i.imageURL)&&!y(i.imageURL)&&!y(i.iconURL)){let g=$(".gas-list-entry-cover",s);g?.length&&(s=o.includes("list-games")?g.css("background-image",`url(${i.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):C(g,i.iconURL||i.imageURL)||s)}if(t.includes(f))s=s.replaceAll(`{|${f}|}`,(f.endsWith("At")?A(u):b(u))||"");else if(a.includes(f))s=s.replaceAll(`{|${f}|}`,Math.round(u||0));else if(f==="lastPlayed")s=s.replaceAll(`{|${f}|}`,A(u));else if(f==="content")s=s.replaceAll(`{|${f}|}`,N(u,160));else if(f==="importedFromPlatform"||f==="platform"||f==="platforms")s=x(u,s);else if(r.key&&f===r.key)for(let g of r.keysToReplace)if(g==="platform")s=x(u[g],s);else if(g==="consoles")for(let d of u[g])console.log("consoleName",d),s=D(d,s);else g==="gameIconURL"?s=Y(u[g],s):typeof u[g]=="string"?s=s.replaceAll(`{|${g}|}`,u[g]):s=s.replaceAll(`{|${g}|}`,Math.round(u[g]||0));else if(f==="rating"){s=s.replaceAll(`{|${f}|}`,Math.round(u||0));let g=$(".gas-list-entry-rating",s);g.length&&(s=g.prepend(H(u)).parents(".gas-list-entry").prop("outerHTML"))}}c.append(s)})):(e?.length&&!m?.length&&console.error(`${o} template issue (missing a '.gas-' class?)`),$(o).html(p),p.show()),c.css("display","flex")}async function Z(e,o,a){let t;a?.length?t=await fetch(`https://${o}/api/id/${a}/guides?perPage=5`):userAuth0Data?.sub?.length&&(t=await fetch(`https://${o}/api/profile/my/guides?perPage=5`,{headers:{Authorization:`Bearer ${token}`}}));let m=(await t.json())?.results,c=`${e}-list-guides`;U({listData:m,elemId:c,numKeysToReplace:["id","commentsCount","likesCount","viewsCount"],textKeysToReplace:["name","author","achievementDescription","profileId"]}),$(`${c} .ga-loader-container`).hide()}async function _(e,o,a){let t;a?.length?t=await fetch(`https://${o}/api/id/${a}/reviews?perPage=5`):userAuth0Data?.sub?.length&&(t=await fetch(`https://${o}/api/profile/my/reviews?perPage=5`,{headers:{Authorization:`Bearer ${token}`}}));let m=(await t.json())?.results,c=`${e}-list-reviews`;U({listData:m,elemId:c,numKeysToReplace:["id"],textKeysToReplace:["name","gameName","achievementDescription","profileId","updatedAt"]}),$(`${c} .ga-loader-container`).hide()}async function F({platform:e,accountId:o,accountName:a},t,r,m){let c=r,p=e.toLowerCase();c=c.filter(i=>i!==p);let n=$(`#ga-pa-linked-${p}`);$(".gas-pa-name",n).text(o).attr("title",`name: ${a}`),n.show(),$(".gas-unlink-pa-btn",n).click(async i=>{i.preventDefault(),confirm(`Your ${e} account will no longer belong to your profile. Are you sure?`)&&(await fetch(`${t}/unlink-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platform:platformNameIdMap(p)})}),n.children().hide(),n.append(`<p id="ga-unlink-message" class="platform-heading">Unlinking your ${p} account\u2026</p>`).css({flexGrow:1,maxWidth:"25%",justifyContent:"center"}),setTimeout(()=>{n.hide(),n.children().show(),$("#ga-unlink-message",n).remove(),linkPlatform(p),sessionStorage.removeItem("prof"),location.reload()},m))})}async function ee(e,o,a){let t=$(`#ga-pa-to-link-${e}`);t.show();let r=$("input[name=external]",t),m=$("input[type=submit]",t),c=$(".gas-link-pa-form",t),p=$(".gas-link-pa-error",t);m.click(async n=>{if(n.preventDefault(),!r.val()?.length){c.hide(),p.css("display","flex"),console.error("Please fill-in the input field with an id"),setTimeout(()=>{p.hide(),c.css("display","flex")},a);return}$("input",t).attr("disabled",!0);let i={platform:platformNameIdMap(e),external:r.val()},l=await fetch(`${o}/link-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)}),s=await l.json();if(l.status!==201){p.css("display","flex"),c.hide(),console.error(s?.message),setTimeout(()=>{p.hide(),$("input",t).attr("disabled",!1),c.css("display","flex")},a);return}c.hide(),$(".gas-link-pa-success",t).attr("title",s?.message).css("display","flex"),setTimeout(()=>{t.hide(),F({platform:e,accountId:s?.platformAccount?.playerId,accountName:s?.platformAccount?.playerName}),sessionStorage.removeItem("prof"),location.reload()},a)})}async function te(e,o,a){let t=$(`${o}-msg-avatar`);e.length||v(t,"Please link first a platform account in order to choose your avatar.","unstyled",()=>{t.css("display","flex")}),e.map(({platform:r})=>{let m=r.toLowerCase();$(`${o}-btn-avatar-${m}`).show().click(async function(){let c=await fetch(`${a}/avatar`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platformId:j(m)})});if(c.status!==201){v(t,"Oops! Issue changing avatar\u2026 Please try later.","error");return}let p=await c.json();p.imageURL?.length&&($(".gas-profile-avatar").removeAttr("srcset").removeAttr("sizes").attr("src",p.imageURL),v(t,"Avatar successfully changed!"))})})}var E=4e3,L="#gas-profile",ae=["playstation","xbox","steam"];function pe(e,o=[]){$(`${L}-pa-code-copied-msg`).hide(),userProfileData.platformVerifierCode?.length?($(`${L}-pa-code`).text(userProfileData.platformVerifierCode),$(`${L}-pa-code-btn`).on("click",async()=>{await navigator.clipboard.writeText(userProfileData.platformVerifierCode),$(`${L}-pa-code-copied-msg`).show(),setTimeout(()=>{$(`${L}-pa-code-copied-msg`).hide()},E)})):$(`${L}-pa-code-btn`).hide();for(let t of o)F(t,e,ae,E);let a=ae.filter(t=>!o.map(({platform:r})=>r.toLowerCase()).includes(t));for(let t of a)ee(t,e,E)}function me(e,o){let a=`${L}-details`,t=$(`${a}`).prop("outerHTML");console.info(`=== ${a} ===`,e);let r=["name","description","guidesCount","gamesCount","completedCount","completion","achievedCount"];for(let[p,n]of Object.entries(e))if(r.includes(p))t=t.replaceAll(`{|${p}|}`,n);else if(p==="gaPoints")t=t.replaceAll("{|gaPoints|}",e.platforms.find(i=>i.platform==="GA")?.gaUserScore??0);else if(p==="platforms"){let i=["accountName","totalGames","completion","ranking"];for(let l of n){for(let s of i)t=t.replaceAll(`{|${I(l.platform)}-${s}|}`,l[s]??"N.A");t=x(l.platform,t,a)}}if($(`${a}`).prop("outerHTML",t),!userAuth0Data?.sub?.length)return;if(te(e.platforms,L,o),pe(o,e.platforms),e.role?.length){let p=e.role.toLowerCase()==="regular";if($(`.gas-role${p?"":"-non"}-regular`).show(),!p){let n=$("#gas-ads-toggle");userProfileData.adsOff&&n.prop("checked",!0),n.on("change",async i=>{let l=`${o}/ads`,s=await fetch(l,{method:"POST",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}});s.status!==201&&n.prop("checked",userProfileData.adsOff),resData=await s.json(),s.status===201&&(userProfileData.adsOff=!userProfileData.adsOff,sessionStorage.setItem("prof",JSON.stringify(userProfileData)),resData?.message?.includes("deactivated")?$(".ads-section").hide():$(".ads-section").show());let f=s.status===201?"success":"error";displayMessage($(`#gas-ads-form .gas-form-${f}`),resData?.message,f)})}}let m=$(".community-div .heading-description-wrapper"),c=m.prop("outerHTML").replaceAll("{|name|}",e.name);m=m.prop("outerHTML",c)}async function oe(e,o){let a;if(o?.length){let t=`${e}/id/${o}`,r=await fetch(t);if(r.status!==200)return!1;a=await r.json()}else if(userProfileData)a=userProfileData;else return!1;return a.visible?(a.id?.length>0&&(document.title=`${a.name?.length?a.name:a.id} | ${document.title}`,me(a,e)),!0):!1}var S=document.querySelector("meta[name=domain]")?.content,ue=new URLSearchParams(location.search),R=ue.get("id"),M="#gas-profile",se=`https://${S}/api/profile`,fe="/";$(".ga-loader-container").show();$(`.action-message-wrapper,#ga-sections-container,.gas-role-non-regular,.gas-role-regular,[id^=ga-pa-linked],[id^=ga-pa-to-link],[id^=${M.slice(1)}-btn-avatar],[id^=${M.slice(1)}-msg]`).hide();$(async()=>{if(await auth0Bootstrap(),R?.length&&$("#user-settings, #ga-user-settings-tab").hide(),await oe(se,R)){await Promise.all([await q(M,S,R),await W(M,R,se),await Z(M,S,R),await _(M,S,R)]),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$(`${M}-btn-delete`).on("click",X),V(),$("#gas-wf-tab-activator").click();return}if(!R?.length&&login){login();return}location.replace(fe)});})();
