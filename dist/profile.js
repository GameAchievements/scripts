(()=>{var k=e=>{let o=a=>`0${a}`.slice(-2),t=new Date(e);return`${t.getFullYear()} . ${o(t.getMonth()+1)} . ${o(t.getDate())}`};var H=e=>{switch(e){case"playstation":return 1;case"xbox":return 2;default:return 3}},S=e=>{switch(e.toLowerCase()){case"playstation":return"psn";case"xbox":return"xbox";case"steam":return"steam";default:return"ga"}};var L=e=>e?.length?e.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):e;var x=(e,o,t="success",a=()=>{},s=4e3)=>{e.addClass(`${t}-message`).css("display","flex"),$("div:first-child",e).text(o),setTimeout(()=>{e.removeClass(`${t}-message`).hide(),a()},s)};var U=()=>{location.hash?.length>0&&$([document.documentElement,document.body]).animate({scrollTop:$(location.hash).offset().top-50},2e3)};var v=e=>e?.includes("steamstatic")||e?.includes("steampowered"),I=e=>e?.includes("images-eds.xboxlive.com");var O=e=>{if(e<25)return"common";if(e<50)return"rare";if(e<75)return"very-rare";if(e>=75)return"ultra-rare"};var A=(e,o,t=".gas-list-entry")=>{let a=o,s={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return s.ps.rgx.test(e)&&(a=$(".gas-platform-psn",a).css("display","inherit").parents(t).prop("outerHTML")),s.steam.rgx.test(e)&&(a=$(".gas-platform-steam",a).css("display","inherit").parents(t).prop("outerHTML")),s.xbox.rgx.test(e)&&(a=$(".gas-platform-xbox",a).css("display","inherit").parents(t).prop("outerHTML")),a};var j=(e,o,t=".gas-list-entry")=>{let a=o,s={ps:{rgx:/ps/gi},xbox:{rgx:/xbox/gi},pc:{rgx:/steam|pc|windows|mac|linux/gi}};return s.ps.rgx.test(e)?(a=$(".gas-console-tags",a).children(":not(.console-playstation)").hide().parents(t).prop("outerHTML"),a=a.replaceAll("PS5",e)):s.pc.rgx.test(e)?(a=$(".gas-console-tags",a).children(":not(.console-pc)").hide().parents(t).prop("outerHTML"),a=a.replaceAll("PC",e)):s.xbox.rgx.test(e)&&(a=$(".gas-console-tags",a).children(":not(.console-xbox)").hide().parents(t).prop("outerHTML"),a=a.replaceAll("XBOX 360",e)),a};var b=(e,o,t=".gas-list-entry")=>e.removeAttr("srcset").removeAttr("sizes").attr("src",o).parents(t).prop("outerHTML");function _(e){switch(e){case 1:return"#FF6C6C";case 2:return"#FF876C";case 3:return"#FFB36C";case 4:return"#FFD66C";case 5:return"#D0FF6C";case 6:return"#6CFFCA";case 7:return"#69E4FF";case 8:return"#99A3FF";case 9:return"#C699FF";case 10:return"#FFA0EA";default:return"#5663BA"}}function ee(e=""){return`<svg ${e} viewBox="0 0 400 283" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M396.063 200.058C387.286 177.198 388.232 171.375 363.69 113.777C342.879 64.745 324.486 39.1518 302.256 32.5827V16.449C302.256 7.35738 294.899 0 285.807 0H260.74C251.648 0 244.291 7.35738 244.291 16.449V30.7959H155.687V16.449C155.687 7.35738 148.277 0 139.238 0H114.17C105.079 0 97.7212 7.35738 97.7212 16.449V32.5827C75.4388 39.1518 57.098 64.745 36.2345 113.777C11.6925 171.427 12.5859 177.25 3.80958 200.058C-4.91416 222.919 0.341103 257.656 30.0859 275.104C59.8833 292.499 89.6806 279.36 114.17 246.568C138.712 213.775 148.329 215.414 169.35 215.414H230.679C251.701 215.414 261.265 213.775 285.807 246.568C310.297 279.36 340.094 292.446 369.891 275.104C399.636 257.709 404.944 222.919 396.168 200.058H396.063Z" />
    </svg>`}function N(e){return ee(`class="bg-review-score" fill="${_(e)}"`)}function te({listData:e,elemId:o,numKeysToReplace:t,textKeysToReplace:a,tabCounts:s,tabMatcher:r}){let l=$(`${o} .gas-list-tabs`);console.info(`=== ${o} results ===`,e);let n=l.prop("outerHTML");(!s||Object.keys(s).length<1)&&(r="platform",s={allCnt:e.length,playstationCnt:e.filter(p=>p[r].toLowerCase()==="playstation")?.length,xboxCnt:e.filter(p=>p[r].toLowerCase()==="xbox")?.length,steamCnt:e.filter(p=>p[r].toLowerCase()==="steam")?.length});let c=Object.keys(s);for(let p of c)n=n.replaceAll(`{|${p}|}`,s[p])||"0";l.prop("outerHTML",n);for(let p of c){let i=p.slice(0,p.indexOf("Cnt")),m=$(`${o} .gas-list-${i}`),h=$(".gas-list-empty",m);if(s[p]>0){let g=m.children().first(),u=$(".gas-list-entry",m).first();u.show(),n=u.prop("outerHTML"),m.html(g).append(u),u.hide(),(i==="all"?e:e.filter(d=>d[r]?.toLowerCase()===i)).forEach((d,Y)=>{let f=n;for(let[y,C]of Object.entries(d)){let M=d.imageURL||d.iconURL;if(M?.length&&!v(M)){let w=$(".gas-list-entry-cover",f);w?.length&&(f=b(w,M)||f)}if(a.includes(y))f=f.replaceAll(`{|${y}|}`,(y.endsWith("At")?k(C):L(C))||"");else if(t.includes(y))f=f.replaceAll(`{|${y}|}`,Math.round(C||0));else if(y==="rating"){f=f.replaceAll(`{|${y}|}`,Math.round(C||0));let w=$(".gas-list-entry-rating",f);w.length&&(f=w.prepend(N(C)).parents(".gas-list-entry").prop("outerHTML"))}else if(y==="platform")f=A(C,f);else if(y==="rarity"){let w=O(C);f=f.replaceAll(`{|${y}|}`,w.replace("-"," ")),f=$(".gas-rarity-tag",f).removeClass("gas-rarity-tag").addClass(`gas-rarity-tag-${w}`).children(".p1").addClass(w).parents(".gas-list-entry").prop("outerHTML")}}m.append(f).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${Y%2>0?"light":"dark"}`)})}else m.html(h),h.show()}}async function B({elemIdPrefix:e,profileId:o,fetchURLPrefix:t},{listName:a,numKeysToReplace:s,textKeysToReplace:r,tabs:l=[],tabMatcher:n}){let c=`${e}-${a}`,p;if(o?.length){let g=`${t}/id/${o}/${a}`;p=await fetch(g)}else userAuth0Data?.sub?.length&&(p=await fetch(`${t}/my/${a}`,{headers:{Authorization:`Bearer ${token}`}}));let i=await p.json(),m=i?.results;if(i?.count){let g;if(Array.isArray(l)){g={};for(let u of l)g[`${u}Cnt`]=u==="all"?m.length:m.filter(d=>d[n]?.toLowerCase()===u)?.length}switch(a){case"reviews":$(".gas-count-reviews").each((u,d)=>{$(d).text($(d).text().replace("{|reviewsCnt|}",m.length)),u>0&&$(d).text($(d).text().replace(`{|${l[u]}ReviewsCnt|}`,g[`${l[u]}Cnt`]))});break;default:break}te({listData:m,elemId:c,numKeysToReplace:s,textKeysToReplace:r,tabCounts:g,tabMatcher:n});return}let h=$(".gas-list-empty").first().clone();$(`${c}`).html(h),h.show()}async function G(e,o,t){await B({elemIdPrefix:e,profileId:o,fetchURLPrefix:t},{listName:"achievements",numKeysToReplace:["id","score","achieversCount","gAPoints"],textKeysToReplace:["name","description","updatedAt"]})}async function K(){if(confirm("This will unlink all your platforms from your profile and remove your profile. Are you sure?")){let e=`https://${apiDomain}/api/user`,o=await fetch(e,{method:"DELETE",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}}),t=$(`${elemIdPrefix}-msg-delete`);if($(this).hide(),o.status!==204){x(t,"Account could not be deleted\u2026 Please try later.","error",()=>{$(this).show()});return}x(t,"Account is successfully being deleted\u2026 Logging out.","success",logout)}}function P({listData:e,elemId:o,numKeysToReplace:t,textKeysToReplace:a}){console.info(`=== ${o} results ===`,e);let s=$(o).prop("outerHTML"),r=$(`${o} .xbox-achievement-list`),l=$(`${o} .empty-state`),n=$(".gh-row",r).first();n.show(),s=n.prop("outerHTML"),n.hide(),e?.length&&s?.length?(r.html(n),e.forEach((c,p)=>{let i=s;i=i.replaceAll("{|idx|}",p+1);for(let[m,h]of Object.entries(c)){if(c.gameIconURL?.length&&!v(c.gameIconURL)){let g=$(".gas-list-entry-cover-game",i);g?.length&&(i=b(g,c.gameIconURL,".gh-row")||i)}if((c.iconURL?.length||c.imageURL?.length)&&!I(c.imageURL)&&!v(c.imageURL)&&!v(c.iconURL)){let g=$(".gas-list-entry-cover",i);g?.length&&(i=o.includes("list-games")?g.css("background-image",`url(${c.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):b(g,c.iconURL||c.imageURL,".gh-row")||i)}if(a.includes(m))i=i.replaceAll(`{|${m}|}`,(m.endsWith("At")?k(h):L(h))||"");else if(t.includes(m))i=i.replaceAll(`{|${m}|}`,Math.round(h||0));else if(m==="importedFromPlatform"||m==="platform"||m==="platforms")i=A(h,i,".gh-row");else if(m==="consoles")for(let g of h)i=j(g,i,".gh-row")}r.append(i)})):(e?.length&&!s?.length&&console.error(`${o} template issue (missing a '.gas-' class?)`),$(o).html(l),l.show()),r.css("display","flex")}async function z(e,o){let s=(await(await fetch(`https://${o}/api/profile/my/games?perPage=25`,{headers:{Authorization:`Bearer ${token}`}})).json())?.results,r=`${e}-games-played`;P({listData:s,elemId:r,numKeysToReplace:["id","gaUserScore","gaTotalScore","userAchievementsCount","achievementsCount","completion"],textKeysToReplace:["name","description"]}),$(`${r} .ga-loader-container`).hide()}async function D({platform:e,accountId:o,accountName:t},a,s){let r=a,l=e.toLowerCase();r=r.filter(c=>c!==l);let n=$(`#ga-pa-linked-${l}`);$(".gas-pa-name",n).text(o).attr("title",`name: ${t}`),n.show(),$(".gas-unlink-pa-btn",n).click(async c=>{c.preventDefault(),confirm(`Your ${e} account will no longer belong to your profile. Are you sure?`)&&(await fetch(`${fetchURLPrefix}/unlink-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platform:platformNameIdMap(l)})}),n.children().hide(),n.append(`<p id="ga-unlink-message" class="platform-heading">Unlinking your ${l} account\u2026</p>`).css({flexGrow:1,maxWidth:"25%",justifyContent:"center"}),setTimeout(()=>{n.hide(),n.children().show(),$("#ga-unlink-message",n).remove(),linkPlatform(l),sessionStorage.removeItem("prof"),location.reload()},s))})}async function J(e,o){let t=$(`#ga-pa-to-link-${e}`);t.show();let a=$("input[name=external]",t),s=$("input[type=submit]",t),r=$(".gas-link-pa-form",t),l=$(".gas-link-pa-error",t);s.click(async n=>{if(n.preventDefault(),!a.val()?.length){r.hide(),l.css("display","flex"),console.error("Please fill-in the input field with an id"),setTimeout(()=>{l.hide(),r.css("display","flex")},o);return}$("input",t).attr("disabled",!0);let c={platform:platformNameIdMap(e),external:a.val()},p=await fetch(`${fetchURLPrefix}/link-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(c)}),i=await p.json();if(p.status!==201){l.css("display","flex"),r.hide(),console.error(i?.message),setTimeout(()=>{l.hide(),$("input",t).attr("disabled",!1),r.css("display","flex")},o);return}r.hide(),$(".gas-link-pa-success",t).attr("title",i?.message).css("display","flex"),setTimeout(()=>{t.hide(),D({platform:e,accountId:i?.platformAccount?.playerId,accountName:i?.platformAccount?.playerName}),sessionStorage.removeItem("prof"),location.reload()},o)})}async function X(e,o,t){let a=$(`${o}-msg-avatar`);e.length||x(a,"Please link first a platform account in order to choose your avatar.","unstyled",()=>{a.css("display","flex")}),e.map(({platform:s})=>{let r=s.toLowerCase();$(`${o}-btn-avatar-${r}`).show().click(async function(){let l=await fetch(`${t}/avatar`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platformId:H(r)})});if(l.status!==201){x(a,"Oops! Issue changing avatar\u2026 Please try later.","error");return}let n=await l.json();n.imageURL?.length&&($(".gas-profile-avatar").removeAttr("srcset").removeAttr("sizes").attr("src",n.imageURL),x(a,"Avatar successfully changed!"))})})}var V=4e3,T="#gas-profile",E=["playstation","xbox","steam"],ae=(e=[])=>{$(`${T}-pa-code-copied-msg`).hide(),userProfileData.platformVerifierCode?.length?($(`${T}-pa-code`).text(userProfileData.platformVerifierCode),$(`${T}-pa-code-btn`).on("click",async()=>{await navigator.clipboard.writeText(userProfileData.platformVerifierCode),$(`${T}-pa-code-copied-msg`).show(),setTimeout(()=>{$(`${T}-pa-code-copied-msg`).hide()},V)})):$(`${T}-pa-code-btn`).hide();for(let o of e)D(o,E,V);E.map(o=>J(o,V))};function oe(e,o){let t=`${T}-details`,a=$(`${t}`).prop("outerHTML");console.info(`=== ${t} ===`,e);let s=["name","description","guidesCount","gamesCount","completedCount","completion","achievedCount"];for(let[r,l]of Object.entries(e))if(s.includes(r))a=a.replaceAll(`{|${r}|}`,l);else if(r==="gaPoints")a=a.replaceAll("{|gaPoints|}",e.platforms.find(n=>n.platform==="GA")?.gaUserScore??0);else if(r==="platforms"){let n=["accountName","totalGames","completion","ranking"];for(let c of l){for(let p of n)a=a.replaceAll(`{|${S(c.platform)}-${p}|}`,c[p]??"N.A");a=A(c.platform,a,t)}}if($(`${t}`).prop("outerHTML",a),!!userAuth0Data?.sub?.length&&(X(e.platforms,T,o),ae(e.platforms),e.role?.length)){let r=e.role.toLowerCase()==="regular";if($(`.gas-role${r?"":"-non"}-regular`).show(),!r){let l=$("#gas-ads-toggle");userProfileData.adsOff&&l.prop("checked",!0),l.on("change",async n=>{let c=`${o}/ads`,p=await fetch(c,{method:"POST",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}});p.status!==201&&l.prop("checked",userProfileData.adsOff),resData=await p.json(),p.status===201&&(userProfileData.adsOff=!userProfileData.adsOff,sessionStorage.setItem("prof",JSON.stringify(userProfileData)),resData?.message?.includes("deactivated")?$(".ads-section").hide():$(".ads-section").show());let i=p.status===201?"success":"error";displayMessage($(`#gas-ads-form .gas-form-${i}`),resData?.message,i)})}}}async function Q(e,o){let t;if(o?.length){let a=`${e}/id/${o}`,s=await fetch(a);if(s.status!==200)return!1;t=await s.json()}else if(userProfileData)t=userProfileData;else return!1;return t.visible?(t.id?.length>0&&(document.title=`${t.name?.length?t.name:t.id} | ${document.title}`,oe(t,e)),!0):!1}var q=document.querySelector("meta[name=domain]")?.content,se=new URLSearchParams(location.search),F=se.get("id"),R="#gas-profile",W=`https://${q}/api/profile`,re="/";$(".ga-loader-container").show();$(`.action-message-wrapper,#ga-sections-container,.gas-role-non-regular,.gas-role-regular,[id^=ga-pa-linked],[id^=ga-pa-to-link],[id^=${R.slice(1)}-btn-avatar],[id^=${R.slice(1)}-msg]`).hide();$(async()=>{if(await auth0Bootstrap(),F?.length&&$("#user-settings, #ga-user-settings-tab").hide(),await Q(W,F)){await Promise.all([await z(R,q),await G(R,F,W)]),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$(`${R}-btn-delete`).on("click",K),U(),$("#gas-wf-tab-activator").click();return}if(!F?.length&&login){login();return}location.replace(re)});})();
