(()=>{var A=e=>{let o=a=>`0${a}`.slice(-2),t=new Date(e);return`${t.getFullYear()} . ${o(t.getMonth()+1)} . ${o(t.getDate())}`};var S=e=>{switch(e){case"playstation":return 1;case"xbox":return 2;default:return 3}},O=e=>{switch(e.toLowerCase()){case"playstation":return"psn";case"xbox":return"xbox";case"steam":return"steam";default:return"ga"}};var b=e=>e?.length?e.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):e;function j(e,o){if(e.length<=o)return e;let t=e.substr(0,o);return t=t.substr(0,Math.min(t.length,t.lastIndexOf(" "))),`${t} ...`}var v=(e,o,t="success",a=()=>{},r=4e3)=>{e.addClass(`${t}-message`).css("display","flex"),$("div:first-child",e).text(o),setTimeout(()=>{e.removeClass(`${t}-message`).hide(),a()},r)};var I=()=>{location.hash?.length>0&&$([document.documentElement,document.body]).animate({scrollTop:$(location.hash).offset().top-50},2e3)};var y=e=>e?.includes("steamstatic")||e?.includes("steampowered"),D=e=>e?.includes("images-eds.xboxlive.com");var N=e=>{if(e<25)return"common";if(e<50)return"rare";if(e<75)return"very-rare";if(e>=75)return"ultra-rare"};var B=(e,o,t,a=!1)=>{e.append(o).children().last().removeClass(["bg-light","bg-dark","locked","unlocked"]).addClass(`bg-${t%2>0?"light":"dark"}`).addClass(`${a?"unlocked":"locked"}`)};var x=(e,o,t=".gas-list-entry")=>{let a=o,r={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return r.ps.rgx.test(e)&&(a=$(".gas-platform-psn",a).css("display","inherit").parents(t).prop("outerHTML")),r.steam.rgx.test(e)&&(a=$(".gas-platform-steam",a).css("display","inherit").parents(t).prop("outerHTML")),r.xbox.rgx.test(e)&&(a=$(".gas-platform-xbox",a).css("display","inherit").parents(t).prop("outerHTML")),a};var V=(e,o,t=".gas-list-entry")=>{let a=o,r={ps:{rgx:/ps/gi},xbox:{rgx:/xbox/gi},pc:{rgx:/steam|pc|windows|mac|linux/gi}};return r.ps.rgx.test(e)?(a=$(".gas-console-tags",a).children(":not(.console-playstation)").hide().parents(t).prop("outerHTML"),a=a.replaceAll("PS5",e)):r.pc.rgx.test(e)?(a=$(".gas-console-tags",a).children(":not(.console-pc)").hide().parents(t).prop("outerHTML"),a=a.replaceAll("PC",e)):r.xbox.rgx.test(e)&&(a=$(".gas-console-tags",a).children(":not(.console-xbox)").hide().parents(t).prop("outerHTML"),a=a.replaceAll("XBOX 360",e)),a};var C=(e,o,t=".gas-list-entry")=>e.removeAttr("srcset").removeAttr("sizes").attr("src",o).parents(t).prop("outerHTML");function se(e){switch(e){case 1:return"#FF6C6C";case 2:return"#FF876C";case 3:return"#FFB36C";case 4:return"#FFD66C";case 5:return"#D0FF6C";case 6:return"#6CFFCA";case 7:return"#69E4FF";case 8:return"#99A3FF";case 9:return"#C699FF";case 10:return"#FFA0EA";default:return"#5663BA"}}function re(e=""){return`<svg ${e} viewBox="0 0 400 283" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M396.063 200.058C387.286 177.198 388.232 171.375 363.69 113.777C342.879 64.745 324.486 39.1518 302.256 32.5827V16.449C302.256 7.35738 294.899 0 285.807 0H260.74C251.648 0 244.291 7.35738 244.291 16.449V30.7959H155.687V16.449C155.687 7.35738 148.277 0 139.238 0H114.17C105.079 0 97.7212 7.35738 97.7212 16.449V32.5827C75.4388 39.1518 57.098 64.745 36.2345 113.777C11.6925 171.427 12.5859 177.25 3.80958 200.058C-4.91416 222.919 0.341103 257.656 30.0859 275.104C59.8833 292.499 89.6806 279.36 114.17 246.568C138.712 213.775 148.329 215.414 169.35 215.414H230.679C251.701 215.414 261.265 213.775 285.807 246.568C310.297 279.36 340.094 292.446 369.891 275.104C399.636 257.709 404.944 222.919 396.168 200.058H396.063Z" />
    </svg>`}function G(e){return re(`class="bg-review-score" fill="${se(e)}"`)}function ne({listData:e,elemId:o,numKeysToReplace:t,textKeysToReplace:a,tabCounts:r,tabMatcher:l}){let n=$(`${o} .gas-list-tabs`);console.info(`=== ${o} results ===`,e);let c=n.prop("outerHTML");(!r||Object.keys(r).length<1)&&(l="platform",r={allCnt:e.length,playstationCnt:e.filter(i=>i[l].toLowerCase()==="playstation")?.length,xboxCnt:e.filter(i=>i[l].toLowerCase()==="xbox")?.length,steamCnt:e.filter(i=>i[l].toLowerCase()==="steam")?.length});let p=Object.keys(r);for(let i of p)c=c.replaceAll(`{|${i}|}`,r[i])||"0";n.prop("outerHTML",c);for(let i of p){let m=i.slice(0,i.indexOf("Cnt")),s=$(`${o} .gas-list-${m}`),f=$(".gas-list-empty",s);if(r[i]>0){let g=s.children().first(),u=$(".gas-list-entry",s).first();u.show(),c=u.prop("outerHTML"),s.html(g).append(u),u.hide(),(m==="all"?e:e.filter(d=>d[l]?.toLowerCase()===m)).forEach((d,ae)=>{let h=c;for(let[w,k]of Object.entries(d)){let H=d.imageURL||d.iconURL;if(H?.length&&!y(H)){let T=$(".gas-list-entry-cover",h);T?.length&&(h=C(T,H)||h)}if(a.includes(w))h=h.replaceAll(`{|${w}|}`,(w.endsWith("At")?A(k):b(k))||"");else if(t.includes(w))h=h.replaceAll(`{|${w}|}`,Math.round(k||0));else if(w==="rating"){h=h.replaceAll(`{|${w}|}`,Math.round(k||0));let T=$(".gas-list-entry-rating",h);T.length&&(h=T.prepend(G(k)).parents(".gas-list-entry").prop("outerHTML"))}else if(w==="platform")h=x(k,h);else if(w==="rarity"){let T=N(k);h=h.replaceAll(`{|${w}|}`,T.replace("-"," ")),h=$(".gas-rarity-tag",h).removeClass("gas-rarity-tag").addClass(`gas-rarity-tag-${T}`).children(".p1").addClass(T).parents(".gas-list-entry").prop("outerHTML")}}s.append(h).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${ae%2>0?"light":"dark"}`)})}else s.html(f),f.show()}}async function z({elemIdPrefix:e,profileId:o,fetchURLPrefix:t},{listName:a,numKeysToReplace:r,textKeysToReplace:l,tabs:n=[],tabMatcher:c}){let p=`${e}-${a}`,i;if(o?.length){let g=`${t}/id/${o}/${a}`;i=await fetch(g)}else userAuth0Data?.sub?.length&&(i=await fetch(`${t}/my/${a}`,{headers:{Authorization:`Bearer ${token}`}}));let m=await i.json(),s=m?.results;if(m?.count){let g;if(Array.isArray(n)){g={};for(let u of n)g[`${u}Cnt`]=u==="all"?s.length:s.filter(d=>d[c]?.toLowerCase()===u)?.length}switch(a){case"reviews":$(".gas-count-reviews").each((u,d)=>{$(d).text($(d).text().replace("{|reviewsCnt|}",s.length)),u>0&&$(d).text($(d).text().replace(`{|${n[u]}ReviewsCnt|}`,g[`${n[u]}Cnt`]))});break;default:break}ne({listData:s,elemId:p,numKeysToReplace:r,textKeysToReplace:l,tabCounts:g,tabMatcher:c});return}let f=$(".gas-list-empty").first().clone();$(`${p}`).html(f),f.show()}async function E(e,o,t){await z({elemIdPrefix:e,profileId:o,fetchURLPrefix:t},{listName:"achievements",numKeysToReplace:["id","score","achieversCount","gAPoints"],textKeysToReplace:["name","description","updatedAt"]})}async function J(){if(confirm("This will unlink all your platforms from your profile and remove your profile. Are you sure?")){let e=`https://${apiDomain}/api/user`,o=await fetch(e,{method:"DELETE",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}}),t=$(`${elemIdPrefix}-msg-delete`);if($(this).hide(),o.status!==204){v(t,"Account could not be deleted\u2026 Please try later.","error",()=>{$(this).show()});return}v(t,"Account is successfully being deleted\u2026 Logging out.","success",logout)}}function X({listData:e,elemId:o,numKeysToReplace:t,textKeysToReplace:a}){console.info(`=== ${o} results ===`,e);let r=$(o).prop("outerHTML"),l=$(`${o} .xbox-achievement-list`),n=$(`${o} .empty-state`),c=$(".gh-row",l).first();c.show(),r=c.prop("outerHTML"),c.hide(),e?.length&&r?.length?(l.html(c),e.forEach((p,i)=>{let m=r;m=m.replaceAll("{|idx|}",i+1);for(let[s,f]of Object.entries(p)){if(p.gameIconURL?.length&&!y(p.gameIconURL)){let g=$(".gas-list-entry-cover-game",m);g?.length&&(m=C(g,p.gameIconURL,".gh-row")||m)}if((p.iconURL?.length||p.imageURL?.length)&&!D(p.imageURL)&&!y(p.imageURL)&&!y(p.iconURL)){let g=$(".gas-list-entry-cover",m);g?.length&&(m=o.includes("list-games")?g.css("background-image",`url(${p.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):C(g,p.iconURL||p.imageURL,".gh-row")||m)}if(a.includes(s))m=m.replaceAll(`{|${s}|}`,(s.endsWith("At")?A(f):b(f))||"");else if(t.includes(s))m=m.replaceAll(`{|${s}|}`,Math.round(f||0));else if(s==="importedFromPlatform"||s==="platform"||s==="platforms")m=x(f,m,".gh-row");else if(s==="consoles")for(let g of f)m=V(g,m,".gh-row")}B(l,m,i,p?.completion===100)})):(e?.length&&!r?.length&&console.error(`${o} template issue (missing a '.gas-' class?)`),$(o).html(n),n.show()),l.css("display","flex")}async function Q(e,o,t){let a;t?.length?a=await fetch(`https://${o}/api/id/${t}/games?perPage=25`):userAuth0Data?.sub?.length&&(a=await fetch(`https://${o}/api/profile/my/games?perPage=25`,{headers:{Authorization:`Bearer ${token}`}}));let l=(await a.json())?.results,n=`${e}-games-played`;X({listData:l,elemId:n,numKeysToReplace:["id","gaUserScore","gaTotalScore","userAchievementsCount","achievementsCount","completion"],textKeysToReplace:["name","description"]}),$(`${n} .ga-loader-container`).hide()}function M({listData:e,elemId:o,numKeysToReplace:t,textKeysToReplace:a,drillDown:r={key:null,keysToReplace:null}}){console.info(`=== ${o} results ===`,e);let l=$(o).prop("outerHTML"),n=$(`${o} .gas-list`),c=$(`${o} .gas-list-empty`),p=$(".gas-list-entry",n).first();p.show(),l=p.prop("outerHTML"),p.hide(),e?.length&&l?.length?(n.html(p),e.forEach((i,m)=>{let s=l;s=s.replaceAll("{|idx|}",m+1);for(let[f,g]of Object.entries(i)){if(i.gameIconURL?.length&&!y(i.gameIconURL)){let u=$(".gas-list-entry-cover-game",s);u?.length&&(s=C(u,i.gameIconURL)||s)}if((i.iconURL?.length||i.imageURL?.length)&&!D(i.imageURL)&&!y(i.imageURL)&&!y(i.iconURL)){let u=$(".gas-list-entry-cover",s);u?.length&&(s=o.includes("list-games")?u.css("background-image",`url(${i.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):C(u,i.iconURL||i.imageURL)||s)}if(a.includes(f))s=s.replaceAll(`{|${f}|}`,(f.endsWith("At")?A(g):b(g))||"");else if(t.includes(f))s=s.replaceAll(`{|${f}|}`,Math.round(g||0));else if(f==="lastPlayed")s=s.replaceAll(`{|${f}|}`,A(g));else if(f==="content")s=s.replaceAll(`{|${f}|}`,j(g,160));else if(f==="importedFromPlatform"||f==="platform"||f==="platforms")s=x(g,s);else if(r.key&&f===r.key)for(let u of r.keysToReplace)u==="platform"?s=x(g[u],s):s=s.replaceAll(`{|${u}|}`,Math.round(g[u]||0))}n.append(s)})):(e?.length&&!l?.length&&console.error(`${o} template issue (missing a '.gas-' class?)`),$(o).html(c),c.show()),n.css("display","flex")}async function W(e,o,t){let a;t?.length?a=await fetch(`https://${o}/api/id/${t}/guides?perPage=5`):userAuth0Data?.sub?.length&&(a=await fetch(`https://${o}/api/profile/my/guides?perPage=5`,{headers:{Authorization:`Bearer ${token}`}}));let l=(await a.json())?.results,n=`${e}-list-guides`;M({listData:l,elemId:n,numKeysToReplace:["id","commentsCount","likesCount","viewsCount"],textKeysToReplace:["name","author","achievementDescription","profileId"]}),$(`${n} .ga-loader-container`).hide()}async function q(e,o,t){let a;t?.length?a=await fetch(`https://${o}/api/id/${t}/reviews?perPage=5`):userAuth0Data?.sub?.length&&(a=await fetch(`https://${o}/api/profile/my/reviews?perPage=5`,{headers:{Authorization:`Bearer ${token}`}}));let l=(await a.json())?.results,n=`${e}-list-reviews`;M({listData:l,elemId:n,numKeysToReplace:["id","rating"],textKeysToReplace:["name","gameName","achievementDescription","profileId","updatedAt"]}),$(`${n} .ga-loader-container`).hide()}async function U({platform:e,accountId:o,accountName:t},a,r){let l=a,n=e.toLowerCase();l=l.filter(p=>p!==n);let c=$(`#ga-pa-linked-${n}`);$(".gas-pa-name",c).text(o).attr("title",`name: ${t}`),c.show(),$(".gas-unlink-pa-btn",c).click(async p=>{p.preventDefault(),confirm(`Your ${e} account will no longer belong to your profile. Are you sure?`)&&(await fetch(`${fetchURLPrefix}/unlink-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platform:platformNameIdMap(n)})}),c.children().hide(),c.append(`<p id="ga-unlink-message" class="platform-heading">Unlinking your ${n} account\u2026</p>`).css({flexGrow:1,maxWidth:"25%",justifyContent:"center"}),setTimeout(()=>{c.hide(),c.children().show(),$("#ga-unlink-message",c).remove(),linkPlatform(n),sessionStorage.removeItem("prof"),location.reload()},r))})}async function Y(e,o){let t=$(`#ga-pa-to-link-${e}`);t.show();let a=$("input[name=external]",t),r=$("input[type=submit]",t),l=$(".gas-link-pa-form",t),n=$(".gas-link-pa-error",t);r.click(async c=>{if(c.preventDefault(),!a.val()?.length){l.hide(),n.css("display","flex"),console.error("Please fill-in the input field with an id"),setTimeout(()=>{n.hide(),l.css("display","flex")},o);return}$("input",t).attr("disabled",!0);let p={platform:platformNameIdMap(e),external:a.val()},i=await fetch(`${fetchURLPrefix}/link-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(p)}),m=await i.json();if(i.status!==201){n.css("display","flex"),l.hide(),console.error(m?.message),setTimeout(()=>{n.hide(),$("input",t).attr("disabled",!1),l.css("display","flex")},o);return}l.hide(),$(".gas-link-pa-success",t).attr("title",m?.message).css("display","flex"),setTimeout(()=>{t.hide(),U({platform:e,accountId:m?.platformAccount?.playerId,accountName:m?.platformAccount?.playerName}),sessionStorage.removeItem("prof"),location.reload()},o)})}async function Z(e,o,t){let a=$(`${o}-msg-avatar`);e.length||v(a,"Please link first a platform account in order to choose your avatar.","unstyled",()=>{a.css("display","flex")}),e.map(({platform:r})=>{let l=r.toLowerCase();$(`${o}-btn-avatar-${l}`).show().click(async function(){let n=await fetch(`${t}/avatar`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platformId:S(l)})});if(n.status!==201){v(a,"Oops! Issue changing avatar\u2026 Please try later.","error");return}let c=await n.json();c.imageURL?.length&&($(".gas-profile-avatar").removeAttr("srcset").removeAttr("sizes").attr("src",c.imageURL),v(a,"Avatar successfully changed!"))})})}var K=4e3,L="#gas-profile",_=["playstation","xbox","steam"],ie=(e=[])=>{$(`${L}-pa-code-copied-msg`).hide(),userProfileData.platformVerifierCode?.length?($(`${L}-pa-code`).text(userProfileData.platformVerifierCode),$(`${L}-pa-code-btn`).on("click",async()=>{await navigator.clipboard.writeText(userProfileData.platformVerifierCode),$(`${L}-pa-code-copied-msg`).show(),setTimeout(()=>{$(`${L}-pa-code-copied-msg`).hide()},K)})):$(`${L}-pa-code-btn`).hide();for(let t of e)U(t,_,K);let o=_.filter(t=>!e.map(({platform:a})=>a.toLowerCase()).includes(t));for(let t of o)Y(t,K)};function le(e,o){let t=`${L}-details`,a=$(`${t}`).prop("outerHTML");console.info(`=== ${t} ===`,e);let r=["name","description","guidesCount","gamesCount","completedCount","completion","achievedCount"];for(let[c,p]of Object.entries(e))if(r.includes(c))a=a.replaceAll(`{|${c}|}`,p);else if(c==="gaPoints")a=a.replaceAll("{|gaPoints|}",e.platforms.find(i=>i.platform==="GA")?.gaUserScore??0);else if(c==="platforms"){let i=["accountName","totalGames","completion","ranking"];for(let m of p){for(let s of i)a=a.replaceAll(`{|${O(m.platform)}-${s}|}`,m[s]??"N.A");a=x(m.platform,a,t)}}if($(`${t}`).prop("outerHTML",a),!userAuth0Data?.sub?.length)return;if(Z(e.platforms,L,o),ie(e.platforms),e.role?.length){let c=e.role.toLowerCase()==="regular";if($(`.gas-role${c?"":"-non"}-regular`).show(),!c){let p=$("#gas-ads-toggle");userProfileData.adsOff&&p.prop("checked",!0),p.on("change",async i=>{let m=`${o}/ads`,s=await fetch(m,{method:"POST",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}});s.status!==201&&p.prop("checked",userProfileData.adsOff),resData=await s.json(),s.status===201&&(userProfileData.adsOff=!userProfileData.adsOff,sessionStorage.setItem("prof",JSON.stringify(userProfileData)),resData?.message?.includes("deactivated")?$(".ads-section").hide():$(".ads-section").show());let f=s.status===201?"success":"error";displayMessage($(`#gas-ads-form .gas-form-${f}`),resData?.message,f)})}}let l=$(".community-div .heading-description-wrapper"),n=l.prop("outerHTML").replaceAll("{|name|}",e.name);l=l.prop("outerHTML",n)}async function ee(e,o){let t;if(o?.length){let a=`${e}/id/${o}`,r=await fetch(a);if(r.status!==200)return!1;t=await r.json()}else if(userProfileData)t=userProfileData;else return!1;return t.visible?(t.id?.length>0&&(document.title=`${t.name?.length?t.name:t.id} | ${document.title}`,le(t,e)),!0):!1}var F=document.querySelector("meta[name=domain]")?.content,ce=new URLSearchParams(location.search),R=ce.get("id"),P="#gas-profile",te=`https://${F}/api/profile`,pe="/";$(".ga-loader-container").show();$(`.action-message-wrapper,#ga-sections-container,.gas-role-non-regular,.gas-role-regular,[id^=ga-pa-linked],[id^=ga-pa-to-link],[id^=${P.slice(1)}-btn-avatar],[id^=${P.slice(1)}-msg]`).hide();$().ready(async()=>{if(await auth0Bootstrap(),R?.length&&$("#user-settings, #ga-user-settings-tab").hide(),await ee(te,R)){await Promise.all([await Q(P,F,R),await E(P,R,te),await W(P,F,R),await q(P,F,R)]),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$(`${P}-btn-delete`).on("click",J),I(),$("#gas-wf-tab-activator").click();return}if(!R?.length&&login){login();return}location.replace(pe)});})();
