(()=>{var A=e=>{let o=t=>`0${t}`.slice(-2),a=new Date(e);return`${a.getFullYear()} . ${o(a.getMonth()+1)} . ${o(a.getDate())}`};var S=e=>{switch(e){case"playstation":return 1;case"xbox":return 2;default:return 3}},O=e=>{switch(e.toLowerCase()){case"playstation":return"psn";case"xbox":return"xbox";case"steam":return"steam";default:return"ga"}};var b=e=>e?.length?e.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):e;function j(e,o){if(e.length<=o)return e;let a=e.substr(0,o);return a=a.substr(0,Math.min(a.length,a.lastIndexOf(" "))),`${a} ...`}var v=(e,o,a="success",t=()=>{},r=4e3)=>{e.addClass(`${a}-message`).css("display","flex"),$("div:first-child",e).text(o),setTimeout(()=>{e.removeClass(`${a}-message`).hide(),t()},r)};var I=()=>{location.hash?.length>0&&$([document.documentElement,document.body]).animate({scrollTop:$(location.hash).offset().top-50},2e3)};var y=e=>e?.includes("steamstatic")||e?.includes("steampowered"),M=e=>e?.includes("images-eds.xboxlive.com");var N=e=>{if(e<25)return"common";if(e<50)return"rare";if(e<75)return"very-rare";if(e>=75)return"ultra-rare"};var B=(e,o,a,t=!1)=>{e.append(o).children().last().removeClass(["bg-light","bg-dark","locked","unlocked"]).addClass(`bg-${a%2>0?"light":"dark"}`).addClass(`${t?"unlocked":"locked"}`)};var x=(e,o,a=".gas-list-entry")=>{let t=o,r={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return r.ps.rgx.test(e)&&(t=$(".gas-platform-psn",t).css("display","inherit").parents(a).prop("outerHTML")),r.steam.rgx.test(e)&&(t=$(".gas-platform-steam",t).css("display","inherit").parents(a).prop("outerHTML")),r.xbox.rgx.test(e)&&(t=$(".gas-platform-xbox",t).css("display","inherit").parents(a).prop("outerHTML")),t};var V=(e,o,a=".gas-list-entry")=>{let t=o,r={ps:{rgx:/ps/gi},xbox:{rgx:/xbox/gi},pc:{rgx:/steam|pc|windows|mac|linux/gi}};return r.ps.rgx.test(e)?(t=$(".gas-console-tags",t).children(":not(.console-playstation)").hide().parents(a).prop("outerHTML"),t=t.replaceAll("PS5",e)):r.pc.rgx.test(e)?(t=$(".gas-console-tags",t).children(":not(.console-pc)").hide().parents(a).prop("outerHTML"),t=t.replaceAll("PC",e)):r.xbox.rgx.test(e)&&(t=$(".gas-console-tags",t).children(":not(.console-xbox)").hide().parents(a).prop("outerHTML"),t=t.replaceAll("XBOX 360",e)),t};var G=(e,o,a=".gh-row")=>{let t=o;return t=$(".total-achievements-wrapper",t).children(`:not(.total-achievements-${e.userAchievementsCount===e.achievementsCount?"completed":"uncompleted"})`).hide().parents(a).prop("outerHTML"),t=t.replaceAll("{|userAchievementsCount|}/{|achievementsCount|}",`${Math.round(e.userAchievementsCount||0)}/${Math.round(e.achievementsCount||0)}`),t};var K=(e,o,a=".gh-row")=>{let t=o;return t=$(".completion-status-wrapper",t).children(`:not(.${e===100?"unlocked":"locked"}-status)`).hide().parents(a).prop("outerHTML"),t=t.replaceAll("{|completion|}",Math.round(e||0)),t};var C=(e,o,a=".gas-list-entry")=>e.removeAttr("srcset").removeAttr("sizes").attr("src",o).parents(a).prop("outerHTML");function ne(e){switch(e){case 1:return"#FF6C6C";case 2:return"#FF876C";case 3:return"#FFB36C";case 4:return"#FFD66C";case 5:return"#D0FF6C";case 6:return"#6CFFCA";case 7:return"#69E4FF";case 8:return"#99A3FF";case 9:return"#C699FF";case 10:return"#FFA0EA";default:return"#5663BA"}}function ie(e=""){return`<svg ${e} viewBox="0 0 400 283" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M396.063 200.058C387.286 177.198 388.232 171.375 363.69 113.777C342.879 64.745 324.486 39.1518 302.256 32.5827V16.449C302.256 7.35738 294.899 0 285.807 0H260.74C251.648 0 244.291 7.35738 244.291 16.449V30.7959H155.687V16.449C155.687 7.35738 148.277 0 139.238 0H114.17C105.079 0 97.7212 7.35738 97.7212 16.449V32.5827C75.4388 39.1518 57.098 64.745 36.2345 113.777C11.6925 171.427 12.5859 177.25 3.80958 200.058C-4.91416 222.919 0.341103 257.656 30.0859 275.104C59.8833 292.499 89.6806 279.36 114.17 246.568C138.712 213.775 148.329 215.414 169.35 215.414H230.679C251.701 215.414 261.265 213.775 285.807 246.568C310.297 279.36 340.094 292.446 369.891 275.104C399.636 257.709 404.944 222.919 396.168 200.058H396.063Z" />
    </svg>`}function z(e){return ie(`class="bg-review-score" fill="${ne(e)}"`)}function le({listData:e,elemId:o,numKeysToReplace:a,textKeysToReplace:t,tabCounts:r,tabMatcher:c}){let i=$(`${o} .gas-list-tabs`);console.info(`=== ${o} results ===`,e);let m=i.prop("outerHTML");(!r||Object.keys(r).length<1)&&(c="platform",r={allCnt:e.length,playstationCnt:e.filter(l=>l[c].toLowerCase()==="playstation")?.length,xboxCnt:e.filter(l=>l[c].toLowerCase()==="xbox")?.length,steamCnt:e.filter(l=>l[c].toLowerCase()==="steam")?.length});let p=Object.keys(r);for(let l of p)m=m.replaceAll(`{|${l}|}`,r[l])||"0";i.prop("outerHTML",m);for(let l of p){let n=l.slice(0,l.indexOf("Cnt")),s=$(`${o} .gas-list-${n}`),f=$(".gas-list-empty",s);if(r[l]>0){let u=s.children().first(),g=$(".gas-list-entry",s).first();g.show(),m=g.prop("outerHTML"),s.html(u).append(g),g.hide(),(n==="all"?e:e.filter(d=>d[c]?.toLowerCase()===n)).forEach((d,se)=>{let h=m;for(let[w,k]of Object.entries(d)){let F=d.imageURL||d.iconURL;if(F?.length&&!y(F)){let T=$(".gas-list-entry-cover",h);T?.length&&(h=C(T,F)||h)}if(t.includes(w))h=h.replaceAll(`{|${w}|}`,(w.endsWith("At")?A(k):b(k))||"");else if(a.includes(w))h=h.replaceAll(`{|${w}|}`,Math.round(k||0));else if(w==="rating"){h=h.replaceAll(`{|${w}|}`,Math.round(k||0));let T=$(".gas-list-entry-rating",h);T.length&&(h=T.prepend(z(k)).parents(".gas-list-entry").prop("outerHTML"))}else if(w==="platform")h=x(k,h);else if(w==="rarity"){let T=N(k);h=h.replaceAll(`{|${w}|}`,T.replace("-"," ")),h=$(".gas-rarity-tag",h).removeClass("gas-rarity-tag").addClass(`gas-rarity-tag-${T}`).children(".p1").addClass(T).parents(".gas-list-entry").prop("outerHTML")}}s.append(h).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${se%2>0?"light":"dark"}`)})}else s.html(f),f.show()}}async function J({elemIdPrefix:e,profileId:o,fetchURLPrefix:a},{listName:t,numKeysToReplace:r,textKeysToReplace:c,tabs:i=[],tabMatcher:m}){let p=`${e}-${t}`,l;if(o?.length){let u=`${a}/id/${o}/${t}`;l=await fetch(u)}else userAuth0Data?.sub?.length&&(l=await fetch(`${a}/my/${t}`,{headers:{Authorization:`Bearer ${token}`}}));let n=await l.json(),s=n?.results;if(n?.count){let u;if(Array.isArray(i)){u={};for(let g of i)u[`${g}Cnt`]=g==="all"?s.length:s.filter(d=>d[m]?.toLowerCase()===g)?.length}switch(t){case"reviews":$(".gas-count-reviews").each((g,d)=>{$(d).text($(d).text().replace("{|reviewsCnt|}",s.length)),g>0&&$(d).text($(d).text().replace(`{|${i[g]}ReviewsCnt|}`,u[`${i[g]}Cnt`]))});break;default:break}le({listData:s,elemId:p,numKeysToReplace:r,textKeysToReplace:c,tabCounts:u,tabMatcher:m});return}let f=$(".gas-list-empty").first().clone();$(`${p}`).html(f),f.show()}async function X(e,o,a){await J({elemIdPrefix:e,profileId:o,fetchURLPrefix:a},{listName:"achievements",numKeysToReplace:["id","score","achieversCount","gAPoints"],textKeysToReplace:["name","description","updatedAt"]})}async function Q(){if(confirm("This will unlink all your platforms from your profile and remove your profile. Are you sure?")){let e=`https://${apiDomain}/api/user`,o=await fetch(e,{method:"DELETE",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}}),a=$(`${elemIdPrefix}-msg-delete`);if($(this).hide(),o.status!==204){v(a,"Account could not be deleted\u2026 Please try later.","error",()=>{$(this).show()});return}v(a,"Account is successfully being deleted\u2026 Logging out.","success",logout)}}function W({listData:e,elemId:o,numKeysToReplace:a,textKeysToReplace:t}){console.info(`=== ${o} results ===`,e);let r=$(o).prop("outerHTML"),c=$(`${o} .xbox-achievement-list`),i=$(`${o} .empty-state`),m=$(".gh-row",c).first();m.show(),r=m.prop("outerHTML"),m.hide(),e?.length&&r?.length?(c.html(m),e.forEach((p,l)=>{let n=r;n=n.replaceAll("{|idx|}",l+1);for(let[s,f]of Object.entries(p)){if(p.gameIconURL?.length&&!y(p.gameIconURL)){let u=$(".gas-list-entry-cover-game",n);u?.length&&(n=C(u,p.gameIconURL,".gh-row")||n)}if((p.iconURL?.length||p.imageURL?.length)&&!M(p.imageURL)&&!y(p.imageURL)&&!y(p.iconURL)){let u=$(".gas-list-entry-cover",n);u?.length&&(n=o.includes("list-games")?u.css("background-image",`url(${p.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):C(u,p.iconURL||p.imageURL,".gh-row")||n)}if(t.includes(s))n=n.replaceAll(`{|${s}|}`,(s.endsWith("At")?A(f):b(f))||"");else if(a.includes(s))n=n.replaceAll(`{|${s}|}`,Math.round(f||0));else if(s==="userAchievementsCount")n=G({userAchievementsCount:p.userAchievementsCount,achievementsCount:p.achievementsCount},n,".gh-row");else if(s==="completion")n=K(f,n,".gh-row");else if(s==="importedFromPlatform"||s==="platform"||s==="platforms")n=x(f,n,".gh-row");else if(s==="consoles")for(let u of f)n=V(u,n,".gh-row")}B(c,n,l,p?.completion===100)})):(e?.length&&!r?.length&&console.error(`${o} template issue (missing a '.gas-' class?)`),$(o).html(i),i.show()),c.css("display","flex")}async function q(e,o,a){let t;a?.length?t=await fetch(`https://${o}/api/id/${a}/games?perPage=25`):userAuth0Data?.sub?.length&&(t=await fetch(`https://${o}/api/profile/my/games?perPage=25`,{headers:{Authorization:`Bearer ${token}`}}));let c=(await t.json())?.results,i=`${e}-games-played`;W({listData:c,elemId:i,numKeysToReplace:["id","gaUserScore","gaTotalScore"],textKeysToReplace:["name","description"]}),$(`${i} .ga-loader-container`).hide()}function U({listData:e,elemId:o,numKeysToReplace:a,textKeysToReplace:t,drillDown:r={key:null,keysToReplace:null}}){console.info(`=== ${o} results ===`,e);let c=$(o).prop("outerHTML"),i=$(`${o} .gas-list`),m=$(`${o} .gas-list-empty`),p=$(".gas-list-entry",i).first();p.show(),c=p.prop("outerHTML"),p.hide(),e?.length&&c?.length?(i.html(p),e.forEach((l,n)=>{let s=c;s=s.replaceAll("{|idx|}",n+1);for(let[f,u]of Object.entries(l)){if(l.gameIconURL?.length&&!y(l.gameIconURL)){let g=$(".gas-list-entry-cover-game",s);g?.length&&(s=C(g,l.gameIconURL)||s)}if((l.iconURL?.length||l.imageURL?.length)&&!M(l.imageURL)&&!y(l.imageURL)&&!y(l.iconURL)){let g=$(".gas-list-entry-cover",s);g?.length&&(s=o.includes("list-games")?g.css("background-image",`url(${l.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):C(g,l.iconURL||l.imageURL)||s)}if(t.includes(f))s=s.replaceAll(`{|${f}|}`,(f.endsWith("At")?A(u):b(u))||"");else if(a.includes(f))s=s.replaceAll(`{|${f}|}`,Math.round(u||0));else if(f==="lastPlayed")s=s.replaceAll(`{|${f}|}`,A(u));else if(f==="content")s=s.replaceAll(`{|${f}|}`,j(u,160));else if(f==="importedFromPlatform"||f==="platform"||f==="platforms")s=x(u,s);else if(r.key&&f===r.key)for(let g of r.keysToReplace)g==="platform"?s=x(u[g],s):s=s.replaceAll(`{|${g}|}`,Math.round(u[g]||0))}i.append(s)})):(e?.length&&!c?.length&&console.error(`${o} template issue (missing a '.gas-' class?)`),$(o).html(m),m.show()),i.css("display","flex")}async function Y(e,o,a){let t;a?.length?t=await fetch(`https://${o}/api/id/${a}/guides?perPage=5`):userAuth0Data?.sub?.length&&(t=await fetch(`https://${o}/api/profile/my/guides?perPage=5`,{headers:{Authorization:`Bearer ${token}`}}));let c=(await t.json())?.results,i=`${e}-list-guides`;U({listData:c,elemId:i,numKeysToReplace:["id","commentsCount","likesCount","viewsCount"],textKeysToReplace:["name","author","achievementDescription","profileId"]}),$(`${i} .ga-loader-container`).hide()}async function Z(e,o,a){let t;a?.length?t=await fetch(`https://${o}/api/id/${a}/reviews?perPage=5`):userAuth0Data?.sub?.length&&(t=await fetch(`https://${o}/api/profile/my/reviews?perPage=5`,{headers:{Authorization:`Bearer ${token}`}}));let c=(await t.json())?.results,i=`${e}-list-reviews`;U({listData:c,elemId:i,numKeysToReplace:["id","rating"],textKeysToReplace:["name","gameName","achievementDescription","profileId","updatedAt"]}),$(`${i} .ga-loader-container`).hide()}async function D({platform:e,accountId:o,accountName:a},t,r){let c=t,i=e.toLowerCase();c=c.filter(p=>p!==i);let m=$(`#ga-pa-linked-${i}`);$(".gas-pa-name",m).text(o).attr("title",`name: ${a}`),m.show(),$(".gas-unlink-pa-btn",m).click(async p=>{p.preventDefault(),confirm(`Your ${e} account will no longer belong to your profile. Are you sure?`)&&(await fetch(`${fetchURLPrefix}/unlink-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platform:platformNameIdMap(i)})}),m.children().hide(),m.append(`<p id="ga-unlink-message" class="platform-heading">Unlinking your ${i} account\u2026</p>`).css({flexGrow:1,maxWidth:"25%",justifyContent:"center"}),setTimeout(()=>{m.hide(),m.children().show(),$("#ga-unlink-message",m).remove(),linkPlatform(i),sessionStorage.removeItem("prof"),location.reload()},r))})}async function _(e,o){let a=$(`#ga-pa-to-link-${e}`);a.show();let t=$("input[name=external]",a),r=$("input[type=submit]",a),c=$(".gas-link-pa-form",a),i=$(".gas-link-pa-error",a);r.click(async m=>{if(m.preventDefault(),!t.val()?.length){c.hide(),i.css("display","flex"),console.error("Please fill-in the input field with an id"),setTimeout(()=>{i.hide(),c.css("display","flex")},o);return}$("input",a).attr("disabled",!0);let p={platform:platformNameIdMap(e),external:t.val()},l=await fetch(`${fetchURLPrefix}/link-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(p)}),n=await l.json();if(l.status!==201){i.css("display","flex"),c.hide(),console.error(n?.message),setTimeout(()=>{i.hide(),$("input",a).attr("disabled",!1),c.css("display","flex")},o);return}c.hide(),$(".gas-link-pa-success",a).attr("title",n?.message).css("display","flex"),setTimeout(()=>{a.hide(),D({platform:e,accountId:n?.platformAccount?.playerId,accountName:n?.platformAccount?.playerName}),sessionStorage.removeItem("prof"),location.reload()},o)})}async function ee(e,o,a){let t=$(`${o}-msg-avatar`);e.length||v(t,"Please link first a platform account in order to choose your avatar.","unstyled",()=>{t.css("display","flex")}),e.map(({platform:r})=>{let c=r.toLowerCase();$(`${o}-btn-avatar-${c}`).show().click(async function(){let i=await fetch(`${a}/avatar`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platformId:S(c)})});if(i.status!==201){v(t,"Oops! Issue changing avatar\u2026 Please try later.","error");return}let m=await i.json();m.imageURL?.length&&($(".gas-profile-avatar").removeAttr("srcset").removeAttr("sizes").attr("src",m.imageURL),v(t,"Avatar successfully changed!"))})})}var E=4e3,L="#gas-profile",te=["playstation","xbox","steam"],ce=(e=[])=>{$(`${L}-pa-code-copied-msg`).hide(),userProfileData.platformVerifierCode?.length?($(`${L}-pa-code`).text(userProfileData.platformVerifierCode),$(`${L}-pa-code-btn`).on("click",async()=>{await navigator.clipboard.writeText(userProfileData.platformVerifierCode),$(`${L}-pa-code-copied-msg`).show(),setTimeout(()=>{$(`${L}-pa-code-copied-msg`).hide()},E)})):$(`${L}-pa-code-btn`).hide();for(let a of e)D(a,te,E);let o=te.filter(a=>!e.map(({platform:t})=>t.toLowerCase()).includes(a));for(let a of o)_(a,E)};function pe(e,o){let a=`${L}-details`,t=$(`${a}`).prop("outerHTML");console.info(`=== ${a} ===`,e);let r=["name","description","guidesCount","gamesCount","completedCount","completion","achievedCount"];for(let[m,p]of Object.entries(e))if(r.includes(m))t=t.replaceAll(`{|${m}|}`,p);else if(m==="gaPoints")t=t.replaceAll("{|gaPoints|}",e.platforms.find(l=>l.platform==="GA")?.gaUserScore??0);else if(m==="platforms"){let l=["accountName","totalGames","completion","ranking"];for(let n of p){for(let s of l)t=t.replaceAll(`{|${O(n.platform)}-${s}|}`,n[s]??"N.A");t=x(n.platform,t,a)}}if($(`${a}`).prop("outerHTML",t),!userAuth0Data?.sub?.length)return;if(ee(e.platforms,L,o),ce(e.platforms),e.role?.length){let m=e.role.toLowerCase()==="regular";if($(`.gas-role${m?"":"-non"}-regular`).show(),!m){let p=$("#gas-ads-toggle");userProfileData.adsOff&&p.prop("checked",!0),p.on("change",async l=>{let n=`${o}/ads`,s=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}});s.status!==201&&p.prop("checked",userProfileData.adsOff),resData=await s.json(),s.status===201&&(userProfileData.adsOff=!userProfileData.adsOff,sessionStorage.setItem("prof",JSON.stringify(userProfileData)),resData?.message?.includes("deactivated")?$(".ads-section").hide():$(".ads-section").show());let f=s.status===201?"success":"error";displayMessage($(`#gas-ads-form .gas-form-${f}`),resData?.message,f)})}}let c=$(".community-div .heading-description-wrapper"),i=c.prop("outerHTML").replaceAll("{|name|}",e.name);c=c.prop("outerHTML",i)}async function ae(e,o){let a;if(o?.length){let t=`${e}/id/${o}`,r=await fetch(t);if(r.status!==200)return!1;a=await r.json()}else if(userProfileData)a=userProfileData;else return!1;return a.visible?(a.id?.length>0&&(document.title=`${a.name?.length?a.name:a.id} | ${document.title}`,pe(a,e)),!0):!1}var H=document.querySelector("meta[name=domain]")?.content,me=new URLSearchParams(location.search),R=me.get("id"),P="#gas-profile",oe=`https://${H}/api/profile`,fe="/";$(".ga-loader-container").show();$(`.action-message-wrapper,#ga-sections-container,.gas-role-non-regular,.gas-role-regular,[id^=ga-pa-linked],[id^=ga-pa-to-link],[id^=${P.slice(1)}-btn-avatar],[id^=${P.slice(1)}-msg]`).hide();$().ready(async()=>{if(await auth0Bootstrap(),R?.length&&$("#user-settings, #ga-user-settings-tab").hide(),await ae(oe,R)){await Promise.all([await q(P,H,R),await X(P,R,oe),await Y(P,H,R),await Z(P,H,R)]),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$(`${P}-btn-delete`).on("click",Q),I(),$("#gas-wf-tab-activator").click();return}if(!R?.length&&login){login();return}location.replace(fe)});})();
