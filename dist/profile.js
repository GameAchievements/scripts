(()=>{var A=(e,t,s=".gas-list-entry")=>{let r={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return r.ps.rgx.test(e)&&(t=$(".gas-platform-psn",t).css("display","inherit").parents(s).prop("outerHTML")),r.steam.rgx.test(e)&&(t=$(".gas-platform-steam",t).css("display","inherit").parents(s).prop("outerHTML")),r.xbox.rgx.test(e)&&(t=$(".gas-platform-xbox",t).css("display","inherit").parents(s).prop("outerHTML")),t};var P=document.querySelector("meta[name=domain]")?.content,j=new URLSearchParams(location.search),x=j.get("id"),d="#gas-profile",w=`https://${P}/api/profile`,I="/",T=4e3;$(".ga-loader-container").show();$(`.action-message-wrapper,#ga-sections-container,.gas-role-non-regular,.gas-role-regular,[id^=ga-pa-linked],[id^=ga-pa-to-link],[id^=${d.slice(1)}-btn-avatar],[id^=${d.slice(1)}-msg]`).hide();var D=Array.from(["playstation","xbox","steam"]),R=({platform:e,accountId:t,accountName:s})=>{let r=e.toLowerCase();D=D.filter(o=>o!==r);let a=$(`#ga-pa-linked-${r}`);$(".gas-pa-name",a).text(t).attr("title",`name: ${s}`),a.show(),$(".gas-unlink-pa-btn",a).click(async o=>{o.preventDefault(),confirm(`Your ${e} account will no longer belong to your profile. Are you sure?`)&&(await fetch(`${w}/unlink-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platform:platformNameIdMap(r)})}),a.children().hide(),a.append(`<p id="ga-unlink-message" class="platform-heading">Unlinking your ${r} account\u2026</p>`).css({flexGrow:1,maxWidth:"25%",justifyContent:"center"}),setTimeout(()=>{a.hide(),a.children().show(),$("#ga-unlink-message",a).remove(),k(r),sessionStorage.removeItem("prof"),location.reload()},T))})},k=e=>{let t=$(`#ga-pa-to-link-${e}`);t.show();let s=$("input[name=external]",t),r=$("input[type=submit]",t),a=$(".gas-link-pa-form",t),o=$(".gas-link-pa-error",t);r.click(async p=>{if(p.preventDefault(),!s.val()?.length){a.hide(),o.css("display","flex"),console.error("Please fill-in the input field with an id"),setTimeout(()=>{o.hide(),a.css("display","flex")},T);return}$("input",t).attr("disabled",!0);let l={platform:platformNameIdMap(e),external:s.val()},c=await fetch(`${w}/link-pa`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)}),i=await c.json();if(c.status!==201){o.css("display","flex"),a.hide(),console.error(i?.message),setTimeout(()=>{o.hide(),$("input",t).attr("disabled",!1),a.css("display","flex")},T);return}a.hide(),$(".gas-link-pa-success",t).attr("title",i?.message).css("display","flex"),setTimeout(()=>{t.hide(),R({platform:e,accountId:i?.platformAccount?.playerId,accountName:i?.platformAccount?.playerName}),sessionStorage.removeItem("prof"),location.reload()},T)})},H=(e=[])=>{$(`${d}-pa-code-copied-msg`).hide(),userProfileData.platformVerifierCode?.length?($(`${d}-pa-code`).text(userProfileData.platformVerifierCode),$(`${d}-pa-code-btn`).on("click",async()=>{await navigator.clipboard.writeText(userProfileData.platformVerifierCode),$(`${d}-pa-code-copied-msg`).show(),setTimeout(()=>{$(`${d}-pa-code-copied-msg`).hide()},T)})):$(`${d}-pa-code-btn`).hide(),e.forEach(R),D.map(k)},S=async e=>{let t=$(`${d}-msg-avatar`);e.length||displayMessage(t,"Please link first a platform account in order to choose your avatar.","unstyled",()=>{t.css("display","flex")}),e.map(({platform:s})=>{let r=s.toLowerCase();$(`${d}-btn-avatar-${r}`).show().click(async function(){let a=await fetch(`${w}/avatar`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platformId:platformNameIdMap(r)})});if(a.status!==201){displayMessage(t,"Oops! Issue changing avatar\u2026 Please try later.","error");return}let o=await a.json();o.imageURL?.length&&($(".gas-profile-avatar").removeAttr("srcset").removeAttr("sizes").attr("src",o.imageURL),displayMessage(t,"Avatar successfully changed!"))})})};function U(e){let t=`${d}-details`,s=$(`${t}`).prop("outerHTML");console.info(`=== ${t} ===`,e);let r=["name","description","gaPoints","guidesCount","gamesCount","completedCount","completion","achievedCount"];if(Object.entries(e).forEach(([a,o])=>{r.includes(a)?s=s.replaceAll(`{|${a}|}`,o):a==="ranking"?Object.entries(o).forEach(([p,l])=>{s=s.replaceAll(`{|${p}|}`,l)}):a==="platforms"&&o.forEach(({platform:p,accountName:l})=>{s=s.replaceAll(`{|${p.toLowerCase()}Name|}`,l),s=A(p,s,t)})}),$(`${t}`).prop("outerHTML",s),!!userAuth0Data?.sub?.length&&(S(e.platforms),H(e.platforms),e.role?.length)){let a=e.role.toLowerCase()==="regular";if($(`.gas-role${a?"":"-non"}-regular`).show(),!a){let o=$("#gas-ads-toggle");userProfileData.adsOff&&o.prop("checked",!0),o.on("change",async p=>{let l=`${w}/ads`,c=await fetch(l,{method:"POST",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}});c.status!==201&&o.prop("checked",userProfileData.adsOff),resData=await c.json(),c.status===201&&(userProfileData.adsOff=!userProfileData.adsOff,sessionStorage.setItem("prof",JSON.stringify(userProfileData)),resData?.message?.includes("deactivated")?$(".ads-section").hide():$(".ads-section").show());let i=c.status===201?"success":"error";displayMessage($(`#gas-ads-form .gas-form-${i}`),resData?.message,i)})}}}var F=async()=>{let e;if(x?.length){let t=`${w}/id/${x}`,s=await fetch(t);if(s.status!==200)return!1;e=await s.json()}else if(userProfileData)e=userProfileData;else return!1;return e.visible?(e.id?.length>0&&(document.title=`${e.name?.length?e.name:e.id} | ${document.title}`,U(e)),!0):!1};function E({listData:e,elemId:t,numKeysToReplace:s,textKeysToReplace:r,tabCounts:a,tabMatcher:o}){let p=$(`${t} .gas-list-tabs`);console.info(`=== ${t} results ===`,e);let l=p.prop("outerHTML");a||(o="platform",a={allCnt:e.length,playstationCnt:e.filter(i=>i[o].toLowerCase()==="playstation")?.length,xboxCnt:e.filter(i=>i[o].toLowerCase()==="xbox")?.length,steamCnt:e.filter(i=>i[o].toLowerCase()==="steam")?.length});let c=Object.keys(a);c.forEach(i=>{l=l.replaceAll(`{|${i}|}`,a[i])||"0"}),p.prop("outerHTML",l),c.forEach(i=>{let g=i.slice(0,i.indexOf("Cnt")),f=$(`${t} .gas-list-${g}`),m=$(".gas-list-empty",f);if(a[i]>0){let M=f.children().first(),L=$(".gas-list-entry",f).first();L.show(),l=L.prop("outerHTML"),f.html(M).append(L),L.hide(),(g==="all"?e:e.filter(C=>C[o]?.toLowerCase()===g)).forEach((C,O)=>{let n=l;Object.entries(C).forEach(([u,y])=>{let v=C.imageURL||C.iconURL;if(v?.length&&!isSteamImage(v)){let h=$(".gas-list-entry-cover",n);h?.length&&(n=showImageFromSrc(h,v)||n)}if(r.includes(u))n=n.replaceAll(`{|${u}|}`,(u.endsWith("At")?gaDate(y):cleanupDoubleQuotes(y))||"");else if(s.includes(u))n=n.replaceAll(`{|${u}|}`,Math.round(y||0));else if(u==="rating"){n=n.replaceAll(`{|${u}|}`,Math.round(y||0));let h=$(".gas-list-entry-rating",n);h.length&&(n=h.prepend(ratingSVG(y)).parents(".gas-list-entry").prop("outerHTML"))}else if(u==="platform")n=A(y,n);else if(u==="rarity"){let h=rarityClassCalc(y);n=n.replaceAll(`{|${u}|}`,h.replace("-"," ")),n=$(".gas-rarity-tag",n).removeClass("gas-rarity-tag").addClass(`gas-rarity-tag-${h}`).children(".p1").addClass(h).parents(".gas-list-entry").prop("outerHTML")}}),f.append(n).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${O%2>0?"light":"dark"}`)})}else f.html(m),m.show()})}async function b({listName:e,numKeysToReplace:t,textKeysToReplace:s,tabs:r,tabMatcher:a}){let o=`${d}-${e}`,p;if(x?.length){let g=`${w}/id/${x}/${e}`;p=await fetch(g)}else userAuth0Data?.sub?.length&&(p=await fetch(`${w}/my/${e}`,{headers:{Authorization:`Bearer ${token}`}}));let l=await p.json(),c=l?.results;if(l?.count){let g;switch(Array.isArray(r)&&(g={},r.forEach(f=>{g[`${f}Cnt`]=f==="all"?c.length:c.filter(m=>m[a]?.toLowerCase()===f)?.length})),e){case"reviews":$(".gas-count-reviews").each((f,m)=>{$(m).text($(m).text().replace("{|reviewsCnt|}",c.length)),f>0&&$(m).text($(m).text().replace(`{|${r[f]}ReviewsCnt|}`,g[`${r[f]}Cnt`]))});break;default:break}E({listData:c,elemId:o,numKeysToReplace:t,textKeysToReplace:s,tabCounts:g,tabMatcher:a});return}let i=$(".gas-list-empty").first().clone();$(`${o}`).html(i),i.show()}$().ready(async()=>{if(await auth0Bootstrap(),x?.length&&$("#user-settings, #ga-user-settings-tab").hide(),await F()){await Promise.all([await b({listName:"games",numKeysToReplace:["id","completion","achievementsCount","hoursPlayed"],textKeysToReplace:["name","description","updatedAt","playedAt"]}),await b({listName:"achievements",numKeysToReplace:["id","score","achieversCount","gAPoints"],textKeysToReplace:["name","description","updatedAt"]}),await b({listName:"guides",numKeysToReplace:["commentsCount","viewsCount","likesCount"],textKeysToReplace:["id","profileId","name","achievementId","achievementName","achievementDescription","updatedAt"]}),await b({listName:"reviews",numKeysToReplace:["id","likesCount","gameId"],textKeysToReplace:["profileId","name","content","gameName","classification","updatedAt"],tabs:["all","positive","mixed","negative"],tabMatcher:"classification"})]),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$(`${d}-btn-delete`).on("click",async function(){if(confirm("This will unlink all your platforms from your profile and remove your profile. Are you sure?")){let e=`https://${P}/api/user`,t=await fetch(e,{method:"DELETE",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}}),s=$(`${d}-msg-delete`);if($(this).hide(),t.status!==204){displayMessage(s,"Account could not be deleted\u2026 Please try later.","error",()=>{$(this).show()});return}displayMessage(s,"Account is successfully being deleted\u2026 Logging out.","success",logout)}}),scrollToURLHash(),$("#gas-wf-tab-activator").click();return}if(!x?.length&&login){login();return}location.replace(I)});})();
