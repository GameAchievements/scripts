(()=>{var g=e=>{let s=r=>`0${r}`.slice(-2),t=new Date(e);return`${t.getFullYear()} . ${s(t.getMonth()+1)} . ${s(t.getDate())}`};var v=e=>e?.length?e.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):e;function C(e,s){if(e.length<=s)return e;let t=e.substr(0,s);return t=t.substr(0,Math.min(t.length,t.lastIndexOf(" "))),`${t} ...`}var d=e=>e?.includes("steamstatic")||e?.includes("steampowered"),A=e=>e?.includes("images-eds.xboxlive.com");var x=(e,s,t=".gas-list-entry")=>{let r=s,a={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return a.ps.rgx.test(e)&&(r=$(".gas-platform-psn",r).css("display","inherit").parents(t).prop("outerHTML")),a.steam.rgx.test(e)&&(r=$(".gas-platform-steam",r).css("display","inherit").parents(t).prop("outerHTML")),a.xbox.rgx.test(e)&&(r=$(".gas-platform-xbox",r).css("display","inherit").parents(t).prop("outerHTML")),r};var y=(e,s,t=".gas-list-entry")=>e.removeAttr("srcset").removeAttr("sizes").attr("src",s).parents(t).prop("outerHTML");function u({listData:e,elemId:s,numKeysToReplace:t,textKeysToReplace:r,drillDown:a={key:null,keysToReplace:null}}){console.info(`=== ${s} results ===`,e);let l=$(s).prop("outerHTML"),p=$(`${s} .gas-list`),f=$(`${s} .gas-list-empty`),h=$(".gas-list-entry",p).first();h.show(),l=h.prop("outerHTML"),h.hide(),e?.length&&l?.length?(p.html(h),e.forEach((i,F)=>{let o=l;o=o.replaceAll("{|idx|}",F+1);for(let[n,m]of Object.entries(i)){if(i.gameIconURL?.length&&!d(i.gameIconURL)){let c=$(".gas-list-entry-cover-game",o);c?.length&&(o=y(c,i.gameIconURL)||o)}if((i.iconURL?.length||i.imageURL?.length)&&!A(i.imageURL)&&!d(i.imageURL)&&!d(i.iconURL)){let c=$(".gas-list-entry-cover",o);c?.length&&(o=s.includes("list-games")?c.css("background-image",`url(${i.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):y(c,i.iconURL||i.imageURL)||o)}if(r.includes(n))o=o.replaceAll(`{|${n}|}`,(n.endsWith("At")?g(m):v(m))||"");else if(t.includes(n))o=o.replaceAll(`{|${n}|}`,Math.round(m||0));else if(n==="lastPlayed")o=o.replaceAll(`{|${n}|}`,g(m));else if(n==="content")o=o.replaceAll(`{|${n}|}`,C(m,160));else if(n==="importedFromPlatform"||n==="platform"||n==="platforms")o=x(m,o);else if(a.key&&n===a.key)for(let c of a.keysToReplace)c==="platform"?o=x(m[c],o):o=o.replaceAll(`{|${c}|}`,Math.round(m[c]||0))}p.append(o)})):(e?.length&&!l?.length&&console.error(`${s} template issue (missing a '.gas-' class?)`),$(s).html(f),f.show()),p.css("display","flex")}async function L(e,s){let t=await fetch(`https://${s}/api/achievement/list/latest`),r=[];t.ok&&(r=(await t.json()).slice(0,4));let a=`${e}-list-achievements-latest`;u({listData:r,elemId:a,numKeysToReplace:["id"],textKeysToReplace:["name","description"],drillDown:{key:"gameVersionData",keysToReplace:["completion","platform","totalAchievements"]}}),$(`${a} .ga-loader-container`).hide()}async function b(e,s,t){let r=await fetch(`https://${s}/api/game/list/${e}`),a=[];r.ok&&(a=(await r.json())?.slice(0,4));let l=`${t}-list-games-${e}`;u({listData:a,elemId:l,numKeysToReplace:["id","players","achievements","averageCompletion","totalAchievements"],textKeysToReplace:["id","name","description","lastPlayed","externalGameId"]}),$(`${l} .ga-loader-container`).hide()}async function R(e,s){let t=await fetch(`https://${s}/api/guide/list?perPage=5&orderBy=createdAt:desc`),r=[];t.ok&&(r=(await t.json()).results?.slice(0,4));let a=`${e}-list-guides`;u({listData:r,elemId:a,numKeysToReplace:["id","comments","likes"],textKeysToReplace:["name","author","description","profileId"]}),$(`${a} .ga-loader-container`).hide()}async function M(e){let t=await(await fetch(`https://${e}/api/game/stats`)).json(),r=$("#top-page"),a=r.prop("outerHTML");console.info("=== #top-page ===",t);let l=["registeredUsers","gamesTracked","achievementsTracked","achievementsUnlocked","forumPosts"];for(let[p,f]of Object.entries(t))l.find(h=>h.toLowerCase()===p.toLowerCase())&&(a=a.replaceAll(`{|${p}|}`,Math.round(f||0)));r.prop("outerHTML",a)}var H=document.querySelector("meta[name=forum-domain]")?.content;async function k(e){let s=await fetch(`https://${H}/api/recent`),t=[];s.ok&&(t=(await s.json()).topics.slice(0,5)),t=t.map(a=>({id:a.cid,title:a.title,topic_id:a.tid,author_name:a.user.username,imageURL:a.user.picture?.toLowerCase().includes("http")?new DOMParser().parseFromString(a.user.picture,"text/html").documentElement.textContent:"https://uploads-ssl.webflow.com/6455fdc10a7247f51c568c32/64b50ee999d75d5f75a28b08_user%20avatar%20default.svg",category_name:a.category.name,category_id:a.category.cid,views:a.viewcount,upvotes:a.upvotes,replies:a.postcount}));let r=`${e}-forum-threads`;u({listData:t,elemId:r,numKeysToReplace:["replies","views","upvotes"],textKeysToReplace:["title","author_name","category_name","topic_id","category_id"]}),$(`${r} .ga-loader-container`).hide()}var w=document.querySelector("meta[name=domain]")?.content,T="#gas-home";$().ready(async()=>{$(".ga-loader-container").show(),await auth0Bootstrap(),await Promise.all(["recent","top"].map(async e=>await b(e,w,T))),await M(w),await R(T,w),await L(T,w),await k(T)});})();
