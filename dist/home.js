(()=>{var u=e=>{let t=o=>`0${o}`.slice(-2),r=new Date(e);return`${r.getFullYear()} . ${t(r.getMonth()+1)} . ${t(r.getDate())}`};var v=e=>e?.length?e.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):e;var f=e=>e?.includes("steamstatic")||e?.includes("steampowered"),L=e=>e?.includes("images-eds.xboxlive.com");var w=(e,t,r=".gas-list-entry")=>{let o={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return o.ps.rgx.test(e)&&(t=$(".gas-platform-psn",t).css("display","inherit").parents(r).prop("outerHTML")),o.steam.rgx.test(e)&&(t=$(".gas-platform-steam",t).css("display","inherit").parents(r).prop("outerHTML")),o.xbox.rgx.test(e)&&(t=$(".gas-platform-xbox",t).css("display","inherit").parents(r).prop("outerHTML")),t};var x=(e,t,r=".gas-list-entry")=>e.removeAttr("srcset").removeAttr("sizes").attr("src",t).parents(r).prop("outerHTML");function m({listData:e,elemId:t,numKeysToReplace:r,textKeysToReplace:o,drillDown:s={key:null,keysToReplace:null}}){console.info(`=== ${t} results ===`,e);let n=$(t).prop("outerHTML"),p=$(`${t} .gas-list`),d=$(`${t} .gas-list-empty`),g=$(".gas-list-entry",p).first();g.show(),n=g.prop("outerHTML"),g.hide(),e?.length&&n?.length?(p.html(g),e.forEach((i,M)=>{let a=n;a=a.replaceAll("{|idx|}",M+1),Object.entries(i).forEach(([c,h])=>{if(i.gameIconURL?.length&&!f(i.gameIconURL)){let l=$(".gas-list-entry-cover-game",a);l?.length&&(a=x(l,i.gameIconURL)||a)}if((i.iconURL?.length||i.imageURL?.length)&&!L(i.imageURL)&&!f(i.imageURL)&&!f(i.iconURL)){let l=$(".gas-list-entry-cover",a);l?.length&&(a=t.includes("list-games")?l.css("background-image",`url(${i.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):x(l,i.iconURL||i.imageURL)||a)}o.includes(c)?a=a.replaceAll(`{|${c}|}`,(c.endsWith("At")?u(h):v(h))||""):r.includes(c)?a=a.replaceAll(`{|${c}|}`,Math.round(h||0)):c==="lastPlayed"?a=a.replaceAll(`{|${c}|}`,u(h)):c==="importedFromPlatform"||c==="platform"||c==="platforms"?a=w(h,a):s.key&&c===s.key&&s.keysToReplace.forEach(l=>{l==="platform"?a=w(h[l],a):a=a.replaceAll(`{|${l}|}`,Math.round(h[l]||0))})}),p.append(a)})):(e?.length&&!n?.length&&console.error(`${t} template issue (missing a '.gas-' class?)`),$(t).html(d),d.show()),p.css("display","flex")}async function T(e,t){let r=await fetch(`https://${t}/api/achievement/list/latest`),o=[];r.ok&&(o=(await r.json()).slice(0,4));let s=`${e}-list-achievements-latest`;m({listData:o,elemId:s,numKeysToReplace:["id"],textKeysToReplace:["name","description"],drillDown:{key:"gameVersionData",keysToReplace:["completion","platform","totalAchievements"]}}),$(`${s} .ga-loader-container`).hide()}async function F(e,t,r){let o=await fetch(`https://${t}/api/game/list/${e}`),s=[];o.ok&&(s=(await o.json())?.slice(0,4));let n=`${r}-list-games-${e}`;m({listData:s,elemId:n,numKeysToReplace:["id","players","achievements","averageCompletion","totalAchievements"],textKeysToReplace:["id","name","description","lastPlayed","externalGameId"]}),$(`${n} .ga-loader-container`).hide()}async function b(e,t){let r=await fetch(`https://${t}/api/guide/list?perPage=5&orderBy=createdAt:desc`),o=[];r.ok&&(o=(await r.json()).results?.slice(0,4));let s=`${e}-list-guides`;m({listData:o,elemId:s,numKeysToReplace:["id","comments","likes"],textKeysToReplace:["name","author","description","profileId"]}),$(`${s} .ga-loader-container`).hide()}async function D(e){let r=await(await fetch(`https://${e}/api/game/stats`)).json(),o=$("#top-page"),s=o.prop("outerHTML");console.info("=== #top-page ===",r);let n=["registeredUsers","gamesTracked","achievementsTracked","achievementsUnlocked","forumPosts"];Object.entries(r).forEach(([p,d])=>{n.find(g=>g.toLowerCase()===p.toLowerCase())&&(s=s.replaceAll(`{|${p}|}`,Math.round(d||0)))}),o.prop("outerHTML",s)}var A=document.querySelector("meta[name=forum-domain]")?.content;async function R(e){let t=await fetch(`https://${A}/api/recent`),r=[];t.ok&&(r=(await t.json()).topics.slice(0,5)),r=r.map(s=>({id:s.cid,title:s.title,topic_id:s.tid,author_name:s.user.username,imageURL:s.user.picture?.toLowerCase().includes("http")?new DOMParser().parseFromString(s.user.picture,"text/html").documentElement.textContent:"https://uploads-ssl.webflow.com/6455fdc10a7247f51c568c32/64b50ee999d75d5f75a28b08_user%20avatar%20default.svg",category_name:s.category.name,category_id:s.category.cid,views:s.viewcount,upvotes:s.upvotes,replies:s.postcount}));let o=`${e}-forum-threads`;m({listData:r,elemId:o,numKeysToReplace:["replies","views","upvotes"],textKeysToReplace:["title","author_name","category_name","topic_id","category_id"]}),$(`${o} .ga-loader-container`).hide()}var y=document.querySelector("meta[name=domain]")?.content,C="#gas-home";$(async()=>{$(".ga-loader-container").show(),await auth0Bootstrap(),await Promise.all(["recent","top"].map(async e=>await F(e,y,C))),await D(y),await b(C,y),await T(C,y),await R(C)});})();
