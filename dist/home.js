(()=>{var f=e=>{let a=r=>`0${r}`.slice(-2),t=new Date(e);return`${t.getFullYear()} . ${a(t.getMonth()+1)} . ${a(t.getDate())}`};var b=e=>e?.length?e.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):e;function T(e,a){if(e.length<=a)return e;let t=e.substr(0,a);return t=t.substr(0,Math.min(t.length,t.lastIndexOf(" "))),`${t} ...`}var x=e=>e?.includes("steamstatic")||e?.includes("steampowered"),A=e=>e?.includes("images-eds.xboxlive.com");var w=(e,a,t=".gas-list-entry")=>{let r=a,s={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return s.ps.rgx.test(e)&&(r=$(".gas-platform-psn",r).css("display","inherit").parents(t).prop("outerHTML")),s.steam.rgx.test(e)&&(r=$(".gas-platform-steam",r).css("display","inherit").parents(t).prop("outerHTML")),s.xbox.rgx.test(e)&&(r=$(".gas-platform-xbox",r).css("display","inherit").parents(t).prop("outerHTML")),r};var y=(e,a,t=".gas-list-entry")=>e.removeAttr("srcset").removeAttr("sizes").attr("src",a).parents(t).prop("outerHTML");function _(e){switch(e){case 1:return"#FF6C6C";case 2:return"#FF876C";case 3:return"#FFB36C";case 4:return"#FFD66C";case 5:return"#D0FF6C";case 6:return"#6CFFCA";case 7:return"#69E4FF";case 8:return"#99A3FF";case 9:return"#C699FF";case 10:return"#FFA0EA";default:return"#5663BA"}}function N(e=""){return`<svg ${e} viewBox="0 0 400 283" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M396.063 200.058C387.286 177.198 388.232 171.375 363.69 113.777C342.879 64.745 324.486 39.1518 302.256 32.5827V16.449C302.256 7.35738 294.899 0 285.807 0H260.74C251.648 0 244.291 7.35738 244.291 16.449V30.7959H155.687V16.449C155.687 7.35738 148.277 0 139.238 0H114.17C105.079 0 97.7212 7.35738 97.7212 16.449V32.5827C75.4388 39.1518 57.098 64.745 36.2345 113.777C11.6925 171.427 12.5859 177.25 3.80958 200.058C-4.91416 222.919 0.341103 257.656 30.0859 275.104C59.8833 292.499 89.6806 279.36 114.17 246.568C138.712 213.775 148.329 215.414 169.35 215.414H230.679C251.701 215.414 261.265 213.775 285.807 246.568C310.297 279.36 340.094 292.446 369.891 275.104C399.636 257.709 404.944 222.919 396.168 200.058H396.063Z" />
    </svg>`}function L(e){return N(`class="bg-review-score" fill="${_(e)}"`)}function k(e,a){let t=a,r=$(".gas-list-entry-cover-game",t);return r?.length&&(t=y(r,e)||t),t}function g({listData:e,elemId:a,numKeysToReplace:t,textKeysToReplace:r,drillDown:s={key:null,keysToReplace:null}}){console.info(`=== ${a} results ===`,e);let n=$(a).prop("outerHTML"),i=$(`${a} .gas-list`),u=$(`${a} .gas-list-empty`),d=$(".gas-list-entry",i).first();d.show(),n=d.prop("outerHTML"),d.hide(),e?.length&&n?.length?(i.html(d),e.forEach((l,h)=>{let o=n;o=o.replaceAll("{|idx|}",h+1);for(let[p,m]of Object.entries(l)){if(l.gameIconURL?.length&&!x(l.gameIconURL)&&(o=k(l.gameIconURL,o)),(l.iconURL?.length||l.imageURL?.length)&&!A(l.imageURL)&&!x(l.imageURL)&&!x(l.iconURL)){let c=$(".gas-list-entry-cover",o);c?.length&&(o=a.includes("list-games")?c.css("background-image",`url(${l.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):y(c,l.iconURL||l.imageURL)||o)}if(r.includes(p))o=o.replaceAll(`{|${p}|}`,(p.endsWith("At")?f(m):b(m))||"");else if(t.includes(p))o=o.replaceAll(`{|${p}|}`,Math.round(m||0));else if(p==="lastPlayed")o=o.replaceAll(`{|${p}|}`,f(m));else if(p==="content")o=o.replaceAll(`{|${p}|}`,T(m,160));else if(p==="importedFromPlatform"||p==="platform"||p==="platforms")o=w(m,o);else if(s.key&&p===s.key)for(let c of s.keysToReplace)c==="platform"?o=w(m[c],o):c==="gameIconURL"?o=k(m[c],o):typeof m[c]=="string"?o=o.replaceAll(`{|${c}|}`,m[c]):o=o.replaceAll(`{|${c}|}`,Math.round(m[c]||0));else if(p==="rating"){o=o.replaceAll(`{|${p}|}`,Math.round(m||0));let c=$(".gas-list-entry-rating",o);c.length&&(o=c.prepend(L(m)).parents(".gas-list-entry").prop("outerHTML"))}}i.append(o)})):(e?.length&&!n?.length&&console.error(`${a} template issue (missing a '.gas-' class?)`),$(a).html(u),u.show()),i.css("display","flex")}async function F(e,a){let t=await fetch(`https://${a}/api/achievement/list/latest`),r=[];t.ok&&(r=(await t.json()).slice(0,4));let s=`${e}-list-achievements-latest`;g({listData:r,elemId:s,numKeysToReplace:["id"],textKeysToReplace:[],drillDown:{key:"gameVersionData",keysToReplace:["completion","platform","totalAchievements","gameIconURL","name","description","gameIconURL"]}}),$(`${s} .ga-loader-container`).hide()}async function H(e,a,t){let r=await fetch(`https://${a}/api/game/list/${e}`),s=[];r.ok&&(s=(await r.json())?.slice(0,4));let n=`${t}-list-games-${e}`;g({listData:s,elemId:n,numKeysToReplace:["id","players","achievements","averageCompletion","totalAchievements"],textKeysToReplace:["id","name","description","lastPlayed","externalGameId"]}),$(`${n} .ga-loader-container`).hide()}function D(e,a,t){let r=$(".gas-filters-sw-li.duplicate-btn",$(e));a===1&&$("#btn-page-next").addClass("disabled");let n=a>t?t-1:a;for(let i=1;i<=a;i++){let u=i>=n&&i!==a;E(r,i,u?"hidden":"",{place:"before",elementId:"#btn-page-next"}),i===a&&a>t&&M({place:"before",elementId:`#btn-page-${i}`})}r.remove()}function E(e,a,t,r={place:"before",elementId:"#btn-page-next"}){let s=e.clone();s.text(a).removeClass("duplicate-btn").addClass(`btn-page ${t??""}`).attr("id",`btn-page-${a}`),r.place==="before"?s.insertBefore(r.elementId):s.insertAfter(r.elementId)}function M(e={place:"before",elementId:"#btn-page-next"}){let a=$('<span class="btn-ellipsis">...</span>');e.place==="before"?a.insertBefore(e.elementId):a.insertAfter(e.elementId)}var S=1,R=5;function U(e,a,t){let r=a-R+1,s=e<=R-1,n=e>=r+1,i=-1;$(".btn-ellipsis",$(t)).remove(),$(".gas-filters-sw",$(t)).children(":not(#btn-page-previous):not(#btn-page-next)").each((u,d)=>{let l=u+1,h=$(d);l===1||l===a||s&&l<=R||n&&l>=r||l===e-S||l===e||l===e+S?h.removeClass("hidden"):(h.addClass("hidden"),(i===-1||!s&&!n&&$("span.btn-ellipsis",t).length<2&&l>e)&&(i=l,M({place:"after",elementId:d})))})}async function I(e,a,t,r){let s=$(".gas-filters-sw-li.active",$(e)).first().text(),n=t.target.innerText.toLowerCase()==="next"?Number(s)+1:t.target.innerText.toLowerCase()==="previous"?Number(s)-1:Number(t.target.innerText);$(".gas-filters-sw-li:not(.btn-ellipsis)",$(e)).removeClass("active").removeClass("disabled"),$(`#btn-page-${n}`,$(e)).addClass("active"),n===a?$("#btn-page-next",$(e)).addClass("disabled"):n===1&&$("#btn-page-previous",$(e)).addClass("disabled"),U(Number(n),a,e),await r()}function B({elemId:e,fetchFn:a,pageBreakpoint:t,totalPages:r}){D(e,r,t),$(`${e} .gas-filters-sw-li`).on("click",s=>I(e,r,s,()=>a())),$("#btn-page-1").addClass("active")}var G=1,X=7;async function V(e,a){let t=$(`${e} .gas-filters-sw-li.active`).text()||1,r=4,s=await fetch(`https://${a}/api/guide/list?perPage=${r}&orderBy=createdAt:desc&offset=${t-1}`),n=[];if(s.ok){let i=await s.json();G=Math.ceil((i?.count||1)/r),n=i.results}g({listData:n,elemId:e,numKeysToReplace:["id","comments","likes"],textKeysToReplace:["name","author","description","profileId"]}),$(`${e} .ga-loader-container`).hide()}async function P(e,a){let t=`${e}-list-guides`;await V(t,a),B({elemId:t,fetchFn:()=>V(t,a),pageBreakpoint:X,totalPages:G})}async function j(e){let t=await(await fetch(`https://${e}/api/game/stats`)).json(),r=$("#top-page"),s=r.prop("outerHTML");console.info("=== #top-page ===",t);let n=["registeredUsers","gamesTracked","achievementsTracked","achievementsUnlocked","forumPosts"];for(let[i,u]of Object.entries(t))n.find(d=>d.toLowerCase()===i.toLowerCase())&&(s=s.replaceAll(`{|${i}|}`,Math.round(u||0)));r.prop("outerHTML",s)}var q=document.querySelector("meta[name=forum-domain]")?.content;async function K(e){let a=await fetch(`https://${q}/api/recent`),t=[];a.ok&&(t=(await a.json()).topics.slice(0,5)),t=t.map(s=>({id:s.cid,title:s.title,topic_id:s.tid,author_name:s.user.username,imageURL:s.user.picture?.toLowerCase().includes("http")?new DOMParser().parseFromString(s.user.picture,"text/html").documentElement.textContent:"https://uploads-ssl.webflow.com/6455fdc10a7247f51c568c32/64b50ee999d75d5f75a28b08_user%20avatar%20default.svg",category_name:s.category.name,category_id:s.category.cid,views:s.viewcount,upvotes:s.upvotes,replies:s.postcount}));let r=`${e}-forum-threads`;g({listData:t,elemId:r,numKeysToReplace:["replies","views","upvotes"],textKeysToReplace:["title","author_name","category_name","topic_id","category_id"]}),$(`${r} .ga-loader-container`).hide()}var v=document.querySelector("meta[name=domain]")?.content,C="#gas-home";$(async()=>{$(".ga-loader-container").show(),await auth0Bootstrap(),await Promise.all(["recent","top"].map(async e=>await H(e,v,C)),await j(v),await P(C,v),await F(C,v),await K(C))});})();
