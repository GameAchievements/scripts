(()=>{var f=e=>{let t=r=>`0${r}`.slice(-2),a=new Date(e);return`${a.getFullYear()} . ${t(a.getMonth()+1)} . ${t(a.getDate())}`};var C=e=>e?.length?e.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):e;function T(e,t){if(e.length<=t)return e;let a=e.substr(0,t);return a=a.substr(0,Math.min(a.length,a.lastIndexOf(" "))),`${a} ...`}var x=e=>e?.includes("steamstatic")||e?.includes("steampowered"),A=e=>e?.includes("images-eds.xboxlive.com");var w=(e,t,a=".gas-list-entry")=>{let r=t,s={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return s.ps.rgx.test(e)&&(r=$(".gas-platform-psn",r).css("display","inherit").parents(a).prop("outerHTML")),s.steam.rgx.test(e)&&(r=$(".gas-platform-steam",r).css("display","inherit").parents(a).prop("outerHTML")),s.xbox.rgx.test(e)&&(r=$(".gas-platform-xbox",r).css("display","inherit").parents(a).prop("outerHTML")),r};var y=(e,t,a=".gas-list-entry")=>e.removeAttr("srcset").removeAttr("sizes").attr("src",t).parents(a).prop("outerHTML");function K(e){switch(e){case 1:return"#FF6C6C";case 2:return"#FF876C";case 3:return"#FFB36C";case 4:return"#FFD66C";case 5:return"#D0FF6C";case 6:return"#6CFFCA";case 7:return"#69E4FF";case 8:return"#99A3FF";case 9:return"#C699FF";case 10:return"#FFA0EA";default:return"#5663BA"}}function O(e=""){return`<svg ${e} viewBox="0 0 400 283" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M396.063 200.058C387.286 177.198 388.232 171.375 363.69 113.777C342.879 64.745 324.486 39.1518 302.256 32.5827V16.449C302.256 7.35738 294.899 0 285.807 0H260.74C251.648 0 244.291 7.35738 244.291 16.449V30.7959H155.687V16.449C155.687 7.35738 148.277 0 139.238 0H114.17C105.079 0 97.7212 7.35738 97.7212 16.449V32.5827C75.4388 39.1518 57.098 64.745 36.2345 113.777C11.6925 171.427 12.5859 177.25 3.80958 200.058C-4.91416 222.919 0.341103 257.656 30.0859 275.104C59.8833 292.499 89.6806 279.36 114.17 246.568C138.712 213.775 148.329 215.414 169.35 215.414H230.679C251.701 215.414 261.265 213.775 285.807 246.568C310.297 279.36 340.094 292.446 369.891 275.104C399.636 257.709 404.944 222.919 396.168 200.058H396.063Z" />
    </svg>`}function L(e){return O(`class="bg-review-score" fill="${K(e)}"`)}function k(e,t){let a=t,r=$(".gas-list-entry-cover-game",a);return r?.length&&(a=y(r,e)||a),a}function h({listData:e,elemId:t,numKeysToReplace:a,textKeysToReplace:r,drillDown:s={key:null,keysToReplace:null}}){console.info(`=== ${t} results ===`,e);let i=$(t).prop("outerHTML"),n=$(`${t} .gas-list`),u=$(`${t} .gas-list-empty`),g=$(".gas-list-entry",n).first();g.show(),i=g.prop("outerHTML"),g.hide(),e?.length&&i?.length?(n.html(g),e.forEach((p,d)=>{let o=i;o=o.replaceAll("{|idx|}",d+1);for(let[c,m]of Object.entries(p)){if(p.gameIconURL?.length&&!x(p.gameIconURL)&&(o=k(p.gameIconURL,o)),(p.iconURL?.length||p.imageURL?.length)&&!A(p.imageURL)&&!x(p.imageURL)&&!x(p.iconURL)){let l=$(".gas-list-entry-cover",o);l?.length&&(o=t.includes("list-games")?l.css("background-image",`url(${p.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):y(l,p.iconURL||p.imageURL)||o)}if(r.includes(c))o=o.replaceAll(`{|${c}|}`,(c.endsWith("At")?f(m):C(m))||"");else if(a.includes(c))o=o.replaceAll(`{|${c}|}`,Math.round(m||0));else if(c==="lastPlayed")o=o.replaceAll(`{|${c}|}`,f(m));else if(c==="content")o=o.replaceAll(`{|${c}|}`,T(m,160));else if(c==="importedFromPlatform"||c==="platform"||c==="platforms")o=w(m,o);else if(s.key&&c===s.key)for(let l of s.keysToReplace)l==="platform"?o=w(m[l],o):l==="gameIconURL"?o=k(m[l],o):typeof m[l]=="string"?o=o.replaceAll(`{|${l}|}`,m[l]):o=o.replaceAll(`{|${l}|}`,Math.round(m[l]||0));else if(c==="rating"){o=o.replaceAll(`{|${c}|}`,Math.round(m||0));let l=$(".gas-list-entry-rating",o);l.length&&(o=l.prepend(L(m)).parents(".gas-list-entry").prop("outerHTML"))}}n.append(o)})):(e?.length&&!i?.length&&console.error(`${t} template issue (missing a '.gas-' class?)`),$(t).html(u),u.show()),n.css("display","flex")}async function H(e,t){let a=await fetch(`https://${t}/api/achievement/list/latest`),r=[];a.ok&&(r=(await a.json()).slice(0,4));let s=`${e}-list-achievements-latest`;h({listData:r,elemId:s,numKeysToReplace:["id"],textKeysToReplace:[],drillDown:{key:"gameVersionData",keysToReplace:["completion","platform","totalAchievements","gameIconURL","name","description","gameIconURL"]}}),$(`${s} .ga-loader-container`).hide()}async function F(e,t,a){let r=await fetch(`https://${t}/api/game/list/${e}`),s=[];r.ok&&(s=(await r.json())?.slice(0,4));let i=`${a}-list-games-${e}`;h({listData:s,elemId:i,numKeysToReplace:["id","players","achievements","averageCompletion","totalAchievements"],textKeysToReplace:["id","name","description","lastPlayed","externalGameId"]}),$(`${i} .ga-loader-container`).hide()}async function S(e,t,a,r,s){let i=$(".gas-filters-sw-li.active",$(e)).first().text(),n=r.target.innerText.toLowerCase()==="next"?Number(i)+1:r.target.innerText.toLowerCase()==="previous"?Number(i)-1:Number(r.target.innerText);$(".gas-filters-sw-li:not(.btn-ellipsis)",$(e)).removeClass("active").removeClass("disabled"),$(`#btn-page-${n}`,$(e)).addClass("active"),n===t?$("#btn-page-next",$(e)).addClass("disabled"):n===1&&$("#btn-page-previous",$(e)).addClass("disabled"),_(Number(n),t,a,$(e)),await s()}var D=1,R=3;function _(e,t,a,r){let s=t-R,i=e<=R,n=e>=s,u=-1;$(".btn-ellipsis").remove(),$(".gas-filters-sw").children(":not(duplicate-btn):not(#btn-page-previous):not(#btn-page-next)").each((g,p)=>{let d=g+1,o=$(p);d===1||d===t||i&&d<=R||n&&d>=s||d===e-D||d===e||d===e+D?o.show():(o.hide(),(u===-1||!i&&!n&&$("span.dots").length<2&&d>currentPage)&&(u=d,o.after('<span class="dots">...</span>')))})}function U(e,t,a){let r=$(".gas-filters-sw-li.duplicate-btn",$(e));if(t===1){$("#btn-page-next").addClass("disabled");return}let i=t>a?a-1:t;for(let n=1;n<=t;n++){let u=n>=i&&n!==t;X(r,n,u?"hidden":"",{place:"before",elementId:"#btn-page-next"}),n===t&&q(r,{place:"before",elementId:`#btn-page-${n}`})}}function X(e,t,a,r={place:"before",elementId:"#btn-page-next"}){let s=e.clone();s.text(t).removeClass("duplicate-btn").addClass(`btn-page ${a??""}`).attr("id",`btn-page-${t}`),r.place==="before"?s.insertBefore(r.elementId):s.insertAfter(r.elementId)}function q(e,t={place:"before",elementId:"#btn-page-next"}){let a=e.clone();a.text("...").removeClass("duplicate-btn").addClass("disabled btn-ellipsis"),t.place==="before"?a.insertBefore(t.elementId):a.insertAfter(t.elementId)}var M=1,B=7;function E(e,t){U(e,M,B),$(`${e} .gas-filters-sw-li`).on("click",a=>S("#gas-home-list-guides",M,B,a,()=>I(e,t))),$("#btn-page-1").addClass("active")}async function I(e,t){let a=$(`${e} .gas-filters-sw-li.active`).text()||1,s=await fetch(`https://${t}/api/guide/list?perPage=4&orderBy=createdAt:desc&offset=0`),i=[];if(s.ok){let n=await s.json();M=15,i=n.results}h({listData:i,elemId:e,numKeysToReplace:["id","comments","likes"],textKeysToReplace:["name","author","description","profileId"]}),$(`${e} .ga-loader-container`).hide()}async function P(e,t){await I(`${e}-list-guides`,t),E(`${e}-list-guides`,t)}async function V(e){let a=await(await fetch(`https://${e}/api/game/stats`)).json(),r=$("#top-page"),s=r.prop("outerHTML");console.info("=== #top-page ===",a);let i=["registeredUsers","gamesTracked","achievementsTracked","achievementsUnlocked","forumPosts"];for(let[n,u]of Object.entries(a))i.find(g=>g.toLowerCase()===n.toLowerCase())&&(s=s.replaceAll(`{|${n}|}`,Math.round(u||0)));r.prop("outerHTML",s)}var J=document.querySelector("meta[name=forum-domain]")?.content;async function G(e){let t=await fetch(`https://${J}/api/recent`),a=[];t.ok&&(a=(await t.json()).topics.slice(0,5)),a=a.map(s=>({id:s.cid,title:s.title,topic_id:s.tid,author_name:s.user.username,imageURL:s.user.picture?.toLowerCase().includes("http")?new DOMParser().parseFromString(s.user.picture,"text/html").documentElement.textContent:"https://uploads-ssl.webflow.com/6455fdc10a7247f51c568c32/64b50ee999d75d5f75a28b08_user%20avatar%20default.svg",category_name:s.category.name,category_id:s.category.cid,views:s.viewcount,upvotes:s.upvotes,replies:s.postcount}));let r=`${e}-forum-threads`;h({listData:a,elemId:r,numKeysToReplace:["replies","views","upvotes"],textKeysToReplace:["title","author_name","category_name","topic_id","category_id"]}),$(`${r} .ga-loader-container`).hide()}var b=document.querySelector("meta[name=domain]")?.content,v="#gas-home";$(async()=>{$(".ga-loader-container").show(),await auth0Bootstrap(),await Promise.all(["recent","top"].map(async e=>await F(e,b,v)),await V(b),await P(v,b),await H(v,b),await G(v))});})();
