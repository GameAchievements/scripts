(()=>{var d=e=>{let r=s=>`0${s}`.slice(-2),t=new Date(e);return`${t.getFullYear()} . ${r(t.getMonth()+1)} . ${r(t.getDate())}`};var v=e=>e?.length?e.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):e;function C(e,r){if(e.length<=r)return e;let t=e.substr(0,r);return t=t.substr(0,Math.min(t.length,t.lastIndexOf(" "))),`${t} ...`}var g=e=>e?.includes("steamstatic")||e?.includes("steampowered"),A=e=>e?.includes("images-eds.xboxlive.com");var x=(e,r,t=".gas-list-entry")=>{let s=r,a={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return a.ps.rgx.test(e)&&(s=$(".gas-platform-psn",s).css("display","inherit").parents(t).prop("outerHTML")),a.steam.rgx.test(e)&&(s=$(".gas-platform-steam",s).css("display","inherit").parents(t).prop("outerHTML")),a.xbox.rgx.test(e)&&(s=$(".gas-platform-xbox",s).css("display","inherit").parents(t).prop("outerHTML")),s};var w=(e,r,t=".gas-list-entry")=>e.removeAttr("srcset").removeAttr("sizes").attr("src",r).parents(t).prop("outerHTML");function u({listData:e,elemId:r,numKeysToReplace:t,textKeysToReplace:s,drillDown:a={key:null,keysToReplace:null}}){console.info(`=== ${r} results ===`,e);let l=$(r).prop("outerHTML"),p=$(`${r} .gas-list`),f=$(`${r} .gas-list-empty`),h=$(".gas-list-entry",p).first();h.show(),l=h.prop("outerHTML"),h.hide(),e?.length&&l?.length?(p.html(h),e.forEach((i,F)=>{let o=l;o=o.replaceAll("{|idx|}",F+1);for(let[n,m]of Object.entries(i)){if(i.gameIconURL?.length&&!g(i.gameIconURL)){let c=$(".gas-list-entry-cover-game",o);c?.length&&(o=w(c,i.gameIconURL)||o)}if((i.iconURL?.length||i.imageURL?.length)&&!A(i.imageURL)&&!g(i.imageURL)&&!g(i.iconURL)){let c=$(".gas-list-entry-cover",o);c?.length&&(o=r.includes("list-games")?c.css("background-image",`url(${i.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):w(c,i.iconURL||i.imageURL)||o)}if(s.includes(n))o=o.replaceAll(`{|${n}|}`,(n.endsWith("At")?d(m):v(m))||"");else if(t.includes(n))o=o.replaceAll(`{|${n}|}`,Math.round(m||0));else if(n==="lastPlayed")o=o.replaceAll(`{|${n}|}`,d(m));else if(n==="content")o=o.replaceAll(`{|${n}|}`,C(m,160));else if(n==="importedFromPlatform"||n==="platform"||n==="platforms")o=x(m,o);else if(a.key&&n===a.key)for(let c of a.keysToReplace)c==="platform"?o=x(m[c],o):o=o.replaceAll(`{|${c}|}`,Math.round(m[c]||0))}p.append(o)})):(e?.length&&!l?.length&&console.error(`${r} template issue (missing a '.gas-' class?)`),$(r).html(f),f.show()),p.css("display","flex")}async function L(e,r){let t=await fetch(`https://${r}/api/achievement/list/latest`),s=[];t.ok&&(s=(await t.json()).slice(0,4));let a=`${e}-list-achievements-latest`;u({listData:s,elemId:a,numKeysToReplace:["id"],textKeysToReplace:["name","description"],drillDown:{key:"gameVersionData",keysToReplace:["completion","platform","totalAchievements"]}}),$(`${a} .ga-loader-container`).hide()}async function b(e,r,t){let s=await fetch(`https://${r}/api/game/list/${e}`),a=[];s.ok&&(a=(await s.json())?.slice(0,4));let l=`${t}-list-games-${e}`;u({listData:a,elemId:l,numKeysToReplace:["id","players","achievements","averageCompletion","totalAchievements"],textKeysToReplace:["id","name","description","lastPlayed","externalGameId"]}),$(`${l} .ga-loader-container`).hide()}async function M(e,r){let t=await fetch(`https://${r}/api/guide/list?perPage=5&orderBy=createdAt:desc`),s=[];t.ok&&(s=(await t.json()).results?.slice(0,4));let a=`${e}-list-guides`;u({listData:s,elemId:a,numKeysToReplace:["id","comments","likes"],textKeysToReplace:["name","author","description","profileId"]}),$(`${a} .ga-loader-container`).hide()}async function k(e){let t=await(await fetch(`https://${e}/api/game/stats`)).json(),s=$("#top-page"),a=s.prop("outerHTML");console.info("=== #top-page ===",t);let l=["registeredUsers","gamesTracked","achievementsTracked","achievementsUnlocked","forumPosts"];for(let[p,f]of Object.entries(t))l.find(h=>h.toLowerCase()===p.toLowerCase())&&(a=a.replaceAll(`{|${p}|}`,Math.round(f||0)));s.prop("outerHTML",a)}var D=document.querySelector("meta[name=forum-domain]")?.content;async function R(e){let r=await fetch(`https://${D}/api/recent`),t=[];r.ok&&(t=(await r.json()).topics.slice(0,5)),t=t.map(a=>({id:a.cid,title:a.title,topic_id:a.tid,author_name:a.user.username,imageURL:a.user.picture?.toLowerCase().includes("http")?new DOMParser().parseFromString(a.user.picture,"text/html").documentElement.textContent:"https://uploads-ssl.webflow.com/6455fdc10a7247f51c568c32/64b50ee999d75d5f75a28b08_user%20avatar%20default.svg",category_name:a.category.name,category_id:a.category.cid,views:a.viewcount,upvotes:a.upvotes,replies:a.postcount}));let s=`${e}-forum-threads`;u({listData:t,elemId:s,numKeysToReplace:["replies","views","upvotes"],textKeysToReplace:["title","author_name","category_name","topic_id","category_id"]}),$(`${s} .ga-loader-container`).hide()}var y=document.querySelector("meta[name=domain]")?.content,T="#gas-home";$().ready(async()=>{$(".ga-loader-container").show(),await auth0Bootstrap(),await Promise.all(["recent","top"].map(async e=>await b(e,y,T))),await k(y),await M(T,y),await L(T,y),await R(T)});})();
