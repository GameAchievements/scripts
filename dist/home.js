(()=>{var f=(a,e,o=".gas-list-entry")=>{let t={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return t.ps.rgx.test(a)&&(e=$(".gas-platform-psn",e).css("display","inherit").parents(o).prop("outerHTML")),t.steam.rgx.test(a)&&(e=$(".gas-platform-steam",e).css("display","inherit").parents(o).prop("outerHTML")),t.xbox.rgx.test(a)&&(e=$(".gas-platform-xbox",e).css("display","inherit").parents(o).prop("outerHTML")),e};var u=document.querySelector("meta[name=domain]")?.content,x=document.querySelector("meta[name=forum-domain]")?.content,d="#gas-home";function y({listData:a,elemId:e,numKeysToReplace:o,textKeysToReplace:t,drillDown:p={key:null,keysToReplace:null}}){console.info(`=== ${e} results ===`,a);let c=$(e).prop("outerHTML"),m=$(`${e} .gas-list`),g=$(`${e} .gas-list-empty`),h=$(".gas-list-entry",m).first();h.show(),c=h.prop("outerHTML"),h.hide(),a?.length&&c?.length?(m.html(h),a.forEach((r,w)=>{let s=c;s=s.replaceAll("{|idx|}",w+1),Object.entries(r).forEach(([n,l])=>{if(r.gameIconURL?.length&&!isSteamImage(r.gameIconURL)){let i=$(".gas-list-entry-cover-game",s);i?.length&&(s=showImageFromSrc(i,r.gameIconURL)||s)}if((r.iconURL?.length||r.imageURL?.length)&&!isXboxEdsImage(r.imageURL)&&!isSteamImage(r.imageURL)&&!isSteamImage(r.iconURL)){let i=$(".gas-list-entry-cover",s);i?.length&&(s=e.includes("list-games")?i.css("background-image",`url(${r.imageURL})`).parents(".gas-list-entry").prop("outerHTML"):showImageFromSrc(i,r.iconURL||r.imageURL)||s)}t.includes(n)?s=s.replaceAll(`{|${n}|}`,(n.endsWith("At")?gaDate(l):cleanupDoubleQuotes(l))||""):o.includes(n)?s=s.replaceAll(`{|${n}|}`,Math.round(l||0)):n==="lastPlayed"?s=s.replaceAll(`{|${n}|}`,gaDate(l)):n==="importedFromPlatform"||n==="platform"||n==="platforms"?s=f(l,s):p.key&&n===p.key&&p.keysToReplace.forEach(i=>{i==="platform"?s=f(l[i],s):s=s.replaceAll(`{|${i}|}`,Math.round(l[i]||0))})}),m.append(s)})):(a?.length&&!c?.length&&console.error(`${e} template issue (missing a '.gas-' class?)`),$(e).html(g),g.show()),m.css("display","flex")}async function L(a){let e=await fetch(`https://${u}/api/game/list/${a}`),o=[];e.ok&&(o=(await e.json())?.slice(0,4));let t=`${d}-list-games-${a}`;y({listData:o,elemId:t,numKeysToReplace:["id","players","achievements","averageCompletion","totalAchievements"],textKeysToReplace:["id","name","description","lastPlayed","externalGameId"]}),$(`${t} .ga-loader-container`).hide()}async function T(){let e=await(await fetch(`https://${u}/api/game/stats`)).json(),o=$("#top-page"),t=o.prop("outerHTML");console.info("=== #top-page ===",e);let p=["registeredUsers","gamesTracked","achievementsTracked","achievementsUnlocked","forumPosts"];Object.entries(e).forEach(([c,m])=>{p.find(g=>g.toLowerCase()===c.toLowerCase())&&(t=t.replaceAll(`{|${c}|}`,Math.round(m||0)))}),o.prop("outerHTML",t)}async function D(){let a=await fetch(`https://${u}/api/guide/list?perPage=5&orderBy=createdAt:desc`),e=[];a.ok&&(e=(await a.json()).results?.slice(0,4));let o=`${d}-list-guides`;y({listData:e,elemId:o,numKeysToReplace:["id","comments","likes"],textKeysToReplace:["name","author","description","profileId"]}),$(`${o} .ga-loader-container`).hide()}async function R(){let a=await fetch(`https://${u}/api/achievement/list/latest`),e=[];a.ok&&(e=(await a.json()).slice(0,4));let o=`${d}-list-achievements-latest`;y({listData:e,elemId:o,numKeysToReplace:["id"],textKeysToReplace:["name","description"],drillDown:{key:"gameVersionData",keysToReplace:["completion","platform","totalAchievements"]}}),$(`${o} .ga-loader-container`).hide()}async function M(){let a=await fetch(`https://${x}/api/recent`),e=[];a.ok&&(e=(await a.json()).topics.slice(0,5)),e=e.map(t=>({id:t.cid,title:t.title,topic_id:t.tid,author_name:t.user.username,imageURL:t.user.picture?.toLowerCase().includes("http")?new DOMParser().parseFromString(t.user.picture,"text/html").documentElement.textContent:"https://uploads-ssl.webflow.com/6455fdc10a7247f51c568c32/64b50ee999d75d5f75a28b08_user%20avatar%20default.svg",category_name:t.category.name,category_id:t.category.cid,views:t.viewcount,upvotes:t.upvotes,replies:t.postcount}));let o=`${d}-forum-threads`;y({listData:e,elemId:o,numKeysToReplace:["replies","views","upvotes"],textKeysToReplace:["title","author_name","category_name","topic_id","category_id"]}),$(`${o} .ga-loader-container`).hide()}$().ready(async()=>{$(".ga-loader-container").show(),await auth0Bootstrap(),await Promise.all(["recent","top"].map(async a=>await L(a))),await T(),await D(),await R(),await M()});})();
