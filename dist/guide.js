(()=>{var f=r=>{let t=e=>`0${e}`.slice(-2),a=new Date(r);return`${a.getFullYear()} . ${t(a.getMonth()+1)} . ${t(a.getDate())}`};var x=r=>{let t=new Date(r),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=`${t.getDate()} ${a[t.getMonth()]}, ${t.getFullYear()}`,o=t.toLocaleTimeString().toLowerCase();return{date:e,time:o}};var w=r=>{if(!r)return"N.A.";let t=r.lastIndexOf(" | ");return t>0?r.slice(0,t):r};var v=(r,t,a=".gas-list-entry")=>{let e=t,o={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return o.ps.rgx.test(r)&&(e=$(".gas-platform-psn",e).css("display","inherit").parents(a).prop("outerHTML")),o.steam.rgx.test(r)&&(e=$(".gas-platform-steam",e).css("display","inherit").parents(a).prop("outerHTML")),o.xbox.rgx.test(r)&&(e=$(".gas-platform-xbox",e).css("display","inherit").parents(a).prop("outerHTML")),e};var u=(r,t,a=".gas-list-entry")=>r.removeAttr("srcset").removeAttr("sizes").attr("src",t).parents(a).prop("outerHTML");var F="#gas-guide";function D({listData:r,elemId:t,textKeysToReplace:a}){console.info(`=== ${t} results ===`,r);let e=$(t).prop("outerHTML"),o=$(`${t} .gas-list`),c=$(".gas-list-empty",o);if(r.count>0&&r.results?.length){let s=o.children().first(),n=$(".gas-list-entry",o).first();n.show(),e=n.prop("outerHTML"),o.html(s).append(n),n.hide(),r.results.forEach((i,p)=>{let l=e;for(let[m,d]of Object.entries(i)){let b=$(".gas-list-entry-cover",l);if(b.length&&i.imageUrl?.length&&(l=u(b,i.imageURL)||l),a.includes(m))l=l.replaceAll(`{|${m}|}`,d||"");else if(m==="date"){let{date:L,time:I}=x(d);l=l.replaceAll(`{|${m}|}`,`${L} at ${I}`)}}o.append(l).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${p%2>0?"light":"dark"}`)})}else o.html(c),c.show();o.show()}async function H({apiDomain:r,guideId:t},{listName:a,textKeysToReplace:e}){let o=`${F}-${a}`,s=await(await fetch(`https://${r}/api/guide/${t}/${a}`)).json();$(`.gas-guide-${a}-count`).text(s.count||""),D({listData:s,elemId:o,textKeysToReplace:e})}async function C(r,t){await H({apiDomain:r,guideId:t},{listName:"comments",numKeysToReplace:[],textKeysToReplace:["profileId","author","comment"]})}var h="#gas-guide";function S(r){let t=$(`${h}-nav`),a=$(`${h}-sections`),e=$(".gas-nav-btn",t).first(),o=$(".gas-section",a).first();for(let c=r.length-1;c>=0;c--){let s=r[c],n=e.clone();n.attr("title",s.title),n.children().first().text(n.text().replace("{|title|}",s.title));let i=c+1;t.prepend(n.attr("href",`${h}-section-${i}`));let p=o.clone(),l=$(".gas-section-title",p);l.text(l.text().replace("{|title|}",`${i} \u203A ${s.title}`));let m=$(".gas-section-content",p);m.html(m.text().replace("{|content|}",s.content)),a.prepend(p.attr("id",`${h.slice(1)}-section-${i}`))}e.remove(),o.remove()}function P(r){let t=`${h}-details`,a=$(t),e=a.prop("outerHTML");console.info(`=== ${t} ===`,r);let o=["id","name","description","achievementId","achievementName","gameId","gameName","profileId","author","createdAt","updatedAt"],c=["comments","upvotes"],s=r.coverURL||r.imageURL;s?.length&&(e=a.css("background-image",`linear-gradient(rgba(255,255,255,0),#030922),
          linear-gradient(rgba(70,89,255,.4),rgba(70,89,255,.4)),
          url(${s})`).prop("outerHTML"));let n=$(".gas-author-cover",e);n?.length&&r.avatar?.length&&(e=u(n,r.avatar,t)||e);for(let[i,p]of Object.entries(r))o.includes(i)?e=e.replaceAll(`{|${i}|}`,(i.endsWith("At")?f(p):p)||""):c.includes(i)?e=e.replaceAll(`{|${i}|}`,Math.round(p||0)):i==="platform"&&(e=v(p,e,t));a.prop("outerHTML",e),S(r.sections)}async function T(r,t){let a=await fetch(`https://${r}/api/guide/${t}`);if(a.status!==200)return;let e=await a.json();return Object.keys(e).length>0&&e.id&&(document.title=`${e.name?.length?e.name:e.id} | ${document.title}`,achievementId=e.achievementId,e.achievementName=w(e.achievementName),P(e)),e}var g;function R(r){g=r;let t=$(`${elemIdPrefix}-btn-like`),a=$(`${elemIdPrefix}-btn-like-del`);g?t.hide():a.hide();let e=async()=>{t.attr("disabled",!0),a.attr("disabled",!0);let o=await fetch(`https://${apiDomain}/api/guide/${guideId}/upvote`,{method:"POST",headers:{Authorization:`Bearer ${token}`}}),c=$(`${elemIdPrefix}-upvotes-count`),s=g?-1:1;if(g=!g,c.text(Number(c.text()||0)+s),o.status===204){t.attr("disabled",!1).show(),a.hide();return}t.hide(),a.attr("disabled",!1).show()};t.on("click",e),a.on("click",e)}var U=r=>{let t=`${elemIdPrefix}-comment-form`;if(r){$(`${elemIdPrefix}-btn-add-comment`).hide(),$(t).parent().hide();return}let a=4e3,e=$(".submit-button",t);e.attr("disabled",!0);let o=$("[name=comment]",t),c=e.text(),s=$(".gas-form-error",t),n=$("div",s),i=s.text(),p=$(".gas-form-success",t);o.on("focusout keyup",function(){$(this).val()?.length?($(this).prev("label").removeClass("field-label-missing"),e.removeClass("disabled-button").attr("disabled",!1)):($(this).prev("label").addClass("field-label-missing"),e.addClass("disabled-button").attr("disabled",!0))}),e.on("click",async l=>{if(l.preventDefault(),!o.val().length){s.show(),n.text("Please write your comment in the box above"),setTimeout(()=>{s.hide(),n.text(i)},a);return}isUserInputActive=!1,$("input",t).attr("disabled",!0),e.text(e.data("wait"));let m=await fetch(`https://${apiDomain}/api/guide/${guideId}/comment`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({comment:o.val()})}),d=await m.json();if(m.status!==201){s.show(),n.text(d?.message),setTimeout(()=>{s.hide(),n.text(i),$("input",t).attr("disabled",!1),e.text(c)},a);return}$("form",t).hide(),p.attr("title",d?.message).show(),setTimeout(()=>{location.reload()},a)})};async function y(){token}var A=document.querySelector("meta[name=domain]")?.content,O=new URLSearchParams(location.search),k=O.get("id")||1;$(".ga-loader-container").show();$("#ga-sections-container").hide();$(async()=>{if(await auth0Bootstrap(),await T(A,k)){await y(),await C(A,k),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$("#gas-wf-tab-activator").click();return}location.replace("/guides")});})();
