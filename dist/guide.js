(()=>{var f=s=>{let e=t=>`0${t}`.slice(-2),r=new Date(s);return`${r.getFullYear()} . ${e(r.getMonth()+1)} . ${e(r.getDate())}`};var x=s=>{let e=new Date(s),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=e.getDate()+" "+r[e.getMonth()]+", "+e.getFullYear(),o=e.toLocaleTimeString().toLowerCase();return{date:t,time:o}};var w=s=>{if(!s)return"N.A.";let e=s.lastIndexOf(" | ");return e>0?s.slice(0,e):s};var v=(s,e,r=".gas-list-entry")=>{let t={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return t.ps.rgx.test(s)&&(e=$(".gas-platform-psn",e).css("display","inherit").parents(r).prop("outerHTML")),t.steam.rgx.test(s)&&(e=$(".gas-platform-steam",e).css("display","inherit").parents(r).prop("outerHTML")),t.xbox.rgx.test(s)&&(e=$(".gas-platform-xbox",e).css("display","inherit").parents(r).prop("outerHTML")),e};var p=(s,e,r=".gas-list-entry")=>s.removeAttr("srcset").removeAttr("sizes").attr("src",e).parents(r).prop("outerHTML");var S="#gas-guide";function A({listData:s,elemId:e,textKeysToReplace:r}){console.info(`=== ${e} results ===`,s);let t=$(e).prop("outerHTML"),o=$(`${e} .gas-list`),c=$(".gas-list-empty",o);if(s.count>0&&s.results?.length){let a=o.children().first(),i=$(".gas-list-entry",o).first();i.show(),t=i.prop("outerHTML"),o.html(a).append(i),i.hide(),s.results.forEach((n,d)=>{let l=t;Object.entries(n).forEach(([m,h])=>{let b=$(".gas-list-entry-cover",l);if(b.length&&n.imageUrl?.length&&(l=p(b,n.imageURL)||l),r.includes(m))l=l.replaceAll(`{|${m}|}`,h||"");else if(m==="date"){let{date:D,time:k}=x(h);l=l.replaceAll(`{|${m}|}`,`${D} at ${k}`)}}),o.append(l).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${d%2>0?"light":"dark"}`)})}else o.html(c),c.show();o.show()}async function H({apiDomain:s,guideId:e},{listName:r,textKeysToReplace:t}){let o=`${S}-${r}`,a=await(await fetch(`https://${s}/api/guide/${e}/${r}`)).json();$(`.gas-guide-${r}-count`).text(a.count||""),A({listData:a,elemId:o,textKeysToReplace:t})}async function C(s,e){await H({apiDomain:s,guideId:e},{listName:"comments",numKeysToReplace:[],textKeysToReplace:["profileId","author","comment"]})}var u="#gas-guide";function P(s){let e=$(`${u}-nav`),r=$(`${u}-sections`),t=$(".gas-nav-btn",e).first(),o=$(".gas-section",r).first();for(let c=s.length-1;c>=0;c--){let a=s[c],i=t.clone();i.attr("title",a.title),i.children().first().text(i.text().replace("{|title|}",a.title));let n=c+1;e.prepend(i.attr("href",`${u}-section-${n}`));let d=o.clone(),l=$(".gas-section-title",d);l.text(l.text().replace("{|title|}",`${n} \u203A ${a.title}`));let m=$(".gas-section-content",d);m.html(m.text().replace("{|content|}",a.content)),r.prepend(d.attr("id",`${u.slice(1)}-section-${n}`))}t.remove(),o.remove()}function R(s){let e=`${u}-details`,r=$(e),t=r.prop("outerHTML");console.info(`=== ${e} ===`,s);let o=["id","name","description","achievementId","achievementName","gameId","gameName","profileId","author","createdAt","updatedAt"],c=["comments","upvotes"],a=s.coverURL||s.imageURL;a?.length&&(t=r.css("background-image",`linear-gradient(rgba(255,255,255,0),#030922),
          linear-gradient(rgba(70,89,255,.4),rgba(70,89,255,.4)),
          url(${a})`).prop("outerHTML"));let i=$(".gas-author-cover",t);i?.length&&s.avatar?.length&&(t=p(i,s.avatar,e)||t),Object.entries(s).forEach(([n,d])=>{o.includes(n)?t=t.replaceAll(`{|${n}|}`,(n.endsWith("At")?f(d):d)||""):c.includes(n)?t=t.replaceAll(`{|${n}|}`,Math.round(d||0)):n==="platform"&&(t=v(d,t,e))}),r.prop("outerHTML",t),P(s.sections)}async function y(s,e){let r=await fetch(`https://${s}/api/guide/${e}`);if(r.status!==200)return;let t=await r.json();return Object.keys(t).length>0&&t.id&&(document.title=`${t.name?.length?t.name:t.id} | ${document.title}`,achievementId=t.achievementId,t.achievementName=w(t.achievementName),R(t)),t}var I=0,g;function N(s){g=s;let e=$(`${elemIdPrefix}-btn-like`),r=$(`${elemIdPrefix}-btn-like-del`);g?e.hide():r.hide();let t=async()=>{e.attr("disabled",!0),r.attr("disabled",!0);let o=await fetch(`https://${apiDomain}/api/guide/${guideId}/upvote`,{method:"POST",headers:{Authorization:`Bearer ${token}`}}),c=$(`${elemIdPrefix}-upvotes-count`),a=g?-1:1;if(g=!g,c.text(Number(c.text()||0)+a),o.status===204){e.attr("disabled",!1).show(),r.hide();return}e.hide(),r.attr("disabled",!1).show()};e.on("click",t),r.on("click",t)}var j=s=>{let e=`${elemIdPrefix}-comment-form`;if(s){$(`${elemIdPrefix}-btn-add-comment`).hide(),$(e).parent().hide();return}let r=4e3,t=$(".submit-button",e);t.attr("disabled",!0);let o=$("[name=comment]",e),c=t.text(),a=$(".gas-form-error",e),i=$("div",a),n=a.text(),d=$(".gas-form-success",e);o.on("focusout keyup",function(){$(this).val()?.length?($(this).prev("label").removeClass("field-label-missing"),t.removeClass("disabled-button").attr("disabled",!1)):($(this).prev("label").addClass("field-label-missing"),t.addClass("disabled-button").attr("disabled",!0))}),t.on("click",async l=>{if(l.preventDefault(),!o.val().length){a.show(),i.text("Please write your comment in the box above"),setTimeout(()=>{a.hide(),i.text(n)},r);return}isUserInputActive=!1,$("input",e).attr("disabled",!0),t.text(t.data("wait"));let m=await fetch(`https://${apiDomain}/api/guide/${guideId}/comment`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({comment:o.val()})}),h=await m.json();if(m.status!==201){a.show(),i.text(h?.message),setTimeout(()=>{a.hide(),i.text(n),$("input",e).attr("disabled",!1),t.text(c)},r);return}$("form",e).hide(),d.attr("title",h?.message).show(),setTimeout(()=>{location.reload()},r)})};async function T(){if(!token||!I)return;let s=await fetch(`https://${apiDomain}/api/achievement/${I}/guide-auth-user-data?id=${guideId}`,{headers:{Authorization:`Bearer ${token}`}});if(s.status!==200){$(`${elemIdPrefix}-nav-auth`).hide(),$(`${elemIdPrefix}-comment-form`).parent().hide();return}let e=await s.json(),r=$(`${elemIdPrefix}-btn-edit`);e.ownedGuideId>0?r.attr("href",`/guide-form?id=${e.ownedGuideId}`).show():r.hide(),N(e.hasLike),j(e.hasComment)}var F=document.querySelector("meta[name=domain]")?.content,U=new URLSearchParams(location.search),L=U.get("id")||1;$(".ga-loader-container").show();$("#ga-sections-container").hide();$().ready(async()=>{if(await auth0Bootstrap(),await y(F,L)){await T(),await C(F,L),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$("#gas-wf-tab-activator").click();return}location.replace("/guides")});})();
