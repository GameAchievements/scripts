(()=>{var f=a=>{let e=t=>`0${t}`.slice(-2),s=new Date(a);return`${s.getFullYear()} . ${e(s.getMonth()+1)} . ${e(s.getDate())}`};var x=a=>{let e=new Date(a),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=`${e.getDate()} ${s[e.getMonth()]}, ${e.getFullYear()}`,r=e.toLocaleTimeString().toLowerCase();return{date:t,time:r}};var v=a=>{if(!a)return"N.A.";let e=a.lastIndexOf(" | ");return e>0?a.slice(0,e):a};var w=(a,e,s=".gas-list-entry")=>{let t=e,r={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return r.ps.rgx.test(a)&&(t=$(".gas-platform-psn",t).css("display","inherit").parents(s).prop("outerHTML")),r.steam.rgx.test(a)&&(t=$(".gas-platform-steam",t).css("display","inherit").parents(s).prop("outerHTML")),r.xbox.rgx.test(a)&&(t=$(".gas-platform-xbox",t).css("display","inherit").parents(s).prop("outerHTML")),e};var u=(a,e,s=".gas-list-entry")=>a.removeAttr("srcset").removeAttr("sizes").attr("src",e).parents(s).prop("outerHTML");var D="#gas-guide";function M({listData:a,elemId:e,textKeysToReplace:s}){console.info(`=== ${e} results ===`,a);let t=$(e).prop("outerHTML"),r=$(`${e} .gas-list`),c=$(".gas-list-empty",r);if(a.count>0&&a.results?.length){let o=r.children().first(),n=$(".gas-list-entry",r).first();n.show(),t=n.prop("outerHTML"),r.html(o).append(n),n.hide(),a.results.forEach((i,m)=>{let l=t;for(let[d,p]of Object.entries(i)){let b=$(".gas-list-entry-cover",l);if(b.length&&i.imageUrl?.length&&(l=u(b,i.imageURL)||l),s.includes(d))l=l.replaceAll(`{|${d}|}`,p||"");else if(d==="date"){let{date:I,time:F}=x(p);l=l.replaceAll(`{|${d}|}`,`${I} at ${F}`)}}r.append(l).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${m%2>0?"light":"dark"}`)})}else r.html(c),c.show();r.show()}async function S({apiDomain:a,guideId:e},{listName:s,textKeysToReplace:t}){let r=`${D}-${s}`,o=await(await fetch(`https://${a}/api/guide/${e}/${s}`)).json();$(`.gas-guide-${s}-count`).text(o.count||""),M({listData:o,elemId:r,textKeysToReplace:t})}async function y(a,e){await S({apiDomain:a,guideId:e},{listName:"comments",numKeysToReplace:[],textKeysToReplace:["profileId","author","comment"]})}var h="#gas-guide";function H(a){let e=$(`${h}-nav`),s=$(`${h}-sections`),t=$(".gas-nav-btn",e).first(),r=$(".gas-section",s).first();for(let c=a.length-1;c>=0;c--){let o=a[c],n=t.clone();n.attr("title",o.title),n.children().first().text(n.text().replace("{|title|}",o.title));let i=c+1;e.prepend(n.attr("href",`${h}-section-${i}`));let m=r.clone(),l=$(".gas-section-title",m);l.text(l.text().replace("{|title|}",`${i} \u203A ${o.title}`));let d=$(".gas-section-content",m);d.html(d.text().replace("{|content|}",o.content)),s.prepend(m.attr("id",`${h.slice(1)}-section-${i}`))}t.remove(),r.remove()}function P(a){let e=`${h}-details`,s=$(e),t=s.prop("outerHTML");console.info(`=== ${e} ===`,a);let r=["id","name","description","achievementId","achievementName","gameId","gameName","profileId","author","createdAt","updatedAt"],c=["comments","upvotes"],o=a.coverURL||a.imageURL;o?.length&&(t=s.css("background-image",`linear-gradient(rgba(255,255,255,0),#030922),
          linear-gradient(rgba(70,89,255,.4),rgba(70,89,255,.4)),
          url(${o})`).prop("outerHTML"));let n=$(".gas-author-cover",t);n?.length&&a.avatar?.length&&(t=u(n,a.avatar,e)||t);for(let[i,m]of Object.entries(a))r.includes(i)?t=t.replaceAll(`{|${i}|}`,(i.endsWith("At")?f(m):m)||""):c.includes(i)?t=t.replaceAll(`{|${i}|}`,Math.round(m||0)):i==="platform"&&(t=w(m,t,e));s.prop("outerHTML",t),H(a.sections)}async function C(a,e){let s=await fetch(`https://${a}/api/guide/${e}`);if(s.status!==200)return;let t=await s.json();return Object.keys(t).length>0&&t.id&&(document.title=`${t.name?.length?t.name:t.id} | ${document.title}`,achievementId=t.achievementId,t.achievementName=v(t.achievementName),P(t)),t}var g;function R(a){g=a;let e=$(`${elemIdPrefix}-btn-like`),s=$(`${elemIdPrefix}-btn-like-del`);g?e.hide():s.hide();let t=async()=>{e.attr("disabled",!0),s.attr("disabled",!0);let r=await fetch(`https://${apiDomain}/api/guide/${guideId}/upvote`,{method:"POST",headers:{Authorization:`Bearer ${token}`}}),c=$(`${elemIdPrefix}-upvotes-count`),o=g?-1:1;if(g=!g,c.text(Number(c.text()||0)+o),r.status===204){e.attr("disabled",!1).show(),s.hide();return}e.hide(),s.attr("disabled",!1).show()};e.on("click",t),s.on("click",t)}var N=a=>{let e=`${elemIdPrefix}-comment-form`;if(a){$(`${elemIdPrefix}-btn-add-comment`).hide(),$(e).parent().hide();return}let s=4e3,t=$(".submit-button",e);t.attr("disabled",!0);let r=$("[name=comment]",e),c=t.text(),o=$(".gas-form-error",e),n=$("div",o),i=o.text(),m=$(".gas-form-success",e);r.on("focusout keyup",function(){$(this).val()?.length?($(this).prev("label").removeClass("field-label-missing"),t.removeClass("disabled-button").attr("disabled",!1)):($(this).prev("label").addClass("field-label-missing"),t.addClass("disabled-button").attr("disabled",!0))}),t.on("click",async l=>{if(l.preventDefault(),!r.val().length){o.show(),n.text("Please write your comment in the box above"),setTimeout(()=>{o.hide(),n.text(i)},s);return}isUserInputActive=!1,$("input",e).attr("disabled",!0),t.text(t.data("wait"));let d=await fetch(`https://${apiDomain}/api/guide/${guideId}/comment`,{method:"POST",headers:{Authorization:`Bearer ${token}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({comment:r.val()})}),p=await d.json();if(d.status!==201){o.show(),n.text(p?.message),setTimeout(()=>{o.hide(),n.text(i),$("input",e).attr("disabled",!1),t.text(c)},s);return}$("form",e).hide(),m.attr("title",p?.message).show(),setTimeout(()=>{location.reload()},s)})};async function T(){token}var A=document.querySelector("meta[name=domain]")?.content,j=new URLSearchParams(location.search),k=j.get("id")||1;$(".ga-loader-container").show();$("#ga-sections-container").hide();$().ready(async()=>{if(await auth0Bootstrap(),await C(A,k)){await T(),await y(A,k),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$("#gas-wf-tab-activator").click();return}location.replace("/guides")});})();
