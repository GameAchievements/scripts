(()=>{async function T(r,e,s,o){if($(`${r}-btn-guide-edit`).hide(),!e)return;let t=await fetch(`https://${s}/api/achievement/${o}/guide-auth-user-data`,{headers:{Authorization:`Bearer ${e}`}});if(t.status!==200)return;let c=await t.json();c?.ownedGuideId>0&&($(`${r}-btn-guide-create`).hide(),$(`${r}-btn-guide-edit`).attr("href",`/guide-form?id=${c.ownedGuideId}`).show())}var v=r=>{let e=new Date(r),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=e.getDate()+" "+s[e.getMonth()]+", "+e.getFullYear(),t=e.toLocaleTimeString().toLowerCase();return{date:o,time:t}};var C=r=>r?.length?r.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):r;var F=r=>{if(r<25)return"common";if(r<50)return"rare";if(r<75)return"very-rare";if(r>=75)return"ultra-rare"},b=(r,e,s=".hero-section-achievement")=>{let o=F(r);return e=$(".rarity-tag-wrapper",e).children(`:not(.gas-rarity-tag-${o})`).hide().parents(s).prop("outerHTML"),e};var L=(r,e,s=".gas-list-entry")=>{let o={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return o.ps.rgx.test(r)&&(e=$(".gas-platform-psn",e).css("display","inherit").parents(s).prop("outerHTML")),o.steam.rgx.test(r)&&(e=$(".gas-platform-steam",e).css("display","inherit").parents(s).prop("outerHTML")),o.xbox.rgx.test(r)&&(e=$(".gas-platform-xbox",e).css("display","inherit").parents(s).prop("outerHTML")),e};var g=(r,e,s=".gas-list-entry")=>r.removeAttr("srcset").removeAttr("sizes").attr("src",e).parents(s).prop("outerHTML");function I({listsData:r,listResultsKey:e,elemId:s,textKeysToReplace:o}){console.info(`=== ${s} results ===`,r);let t=$(s),c=t.prop("outerHTML"),n=$(".gas-list-empty",t),p=t.children().first(),i=$(".gas-list-entry",t).first();t.html(p);let l=r[e];l?.length>0?(i.show(),t.append(i),c=i.prop("outerHTML"),i.hide(),l.forEach((m,f)=>{let a=c;Object.entries(m).forEach(([h,d])=>{let u=$(".gas-list-entry-cover",a);if(u?.length&&m.iconURL?.length&&(a=g(u,m.iconURL)||a),a=a.replaceAll("{|idx|}",f+1),h==="unlockedAt"){let{date:D,time:S}=v(d);a=a.replaceAll("{|unlockedDt|}",D||"N.A."),a=a.replaceAll(`{|${h}|}`,S||"N.A.")}else o.includes(h)&&(a=a.replaceAll(`{|${h}|}`,d||""))}),t.append(a).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${f%2>0?"light":"dark"}`)})):(t.append(n),n.show()),t.show()}async function A({elemIdPrefix:r,apiDomain:e,achievementId:s},{listName:o,type:t,textKeysToReplace:c}){let n=`${r}-${o}-${t==="last"?"latest":t}`,i=await(await fetch(`https://${e}/api/achievement/${s}/${o}?type=${t}`)).json();I({listsData:i,listResultsKey:o,elemId:n,textKeysToReplace:c})}async function M(r,e,s){await A({elemIdPrefix:r,apiDomain:e,achievementId:s},{listName:"achievers",type:"first",textKeysToReplace:["name","profileId"]}),await A({elemIdPrefix:r,apiDomain:e,achievementId:s},{listName:"achievers",type:"last",textKeysToReplace:["name","profileId"]})}function j({listData:r,listResultsKey:e,elemId:s,numKeysToReplace:o,textKeysToReplace:t}){console.info(`=== ${s} results ===`,r);let c=$(s).prop("outerHTML"),n=$(`${s} .gas-list`),p=$(".gas-list-empty",n);if(r.count>0&&r[e]?.length){let i=n.children().first(),l=$(".gas-list-entry",n).first();l.show(),c=l.prop("outerHTML"),n.html(i).append(l),l.hide(),r[e].forEach((m,f)=>{let a=c;Object.entries(m).forEach(([h,d])=>{let u=$(".gas-list-entry-cover",a);u?.length&&m.iconURL?.length&&(a=g(u,m.iconURL)||a),t.includes(h)?a=a.replaceAll(`{|${h}|}`,C(d)||""):o.includes(h)&&(a=a.replaceAll(`{|${h}|}`,Math.round(d||0)))}),n.append(a).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${f%2>0?"light":"dark"}`)})}else n.html(p),p.show();n.css("display","flex")}async function V({elemIdPrefix:r,apiDomain:e,achievementId:s},{listName:o,numKeysToReplace:t,textKeysToReplace:c}){let n=`${r}-${o}`,i=await(await fetch(`https://${e}/api/achievement/${s}/${o}`)).json();j({listData:i,listResultsKey:o,elemId:n,numKeysToReplace:t,textKeysToReplace:c})}async function H(r,e,s){await V({elemIdPrefix:r,apiDomain:e,achievementId:s},{listName:"guides",numKeysToReplace:["id","commentsCount","viewsCount","likesCount"],textKeysToReplace:["profileId","name","description","author"]})}function G(r,e){let s=`${r}-details`,o=$(s),t=o.prop("outerHTML");console.info(`=== ${s} ===`,e);let c=["id","name","description","gameId","gameName"],n=["achievers","completionPercentage","guides","gaPoints"],p=e.coverURL||e.imageURL||e.gameImageURL;p?.length&&(t=o.css("background-image",`linear-gradient(rgba(255,255,255,0),#030922),
          linear-gradient(rgba(70,89,255,.4),rgba(70,89,255,.4)),
          url(${p})`).prop("outerHTML")),$(".achievement-main-img",t).each((i,l)=>{e.imageURL?.length&&(t=g($(l),e.imageURL,s)||t)}),Object.entries(e).forEach(([i,l])=>{c.includes(i)?t=t.replaceAll(`{|${i}|}`,l):n.includes(i)?t=t.replaceAll(`{|${i}|}`,Math.round(l||0)):i==="platform"?t=L(l,t,s):i==="rarity"&&(t=b(l,t))}),o.prop("outerHTML",t)}async function R(r,e,s){let o=await fetch(`https://${e}/api/achievement/${s}`);if(o.status!==200)return;let t=await o.json();return Object.keys(t).length>0&&t.id&&(document.title=`${t.name?.length?t.name:t.id} | ${document.title}`,G(r,t)),t}var w=document.querySelector("meta[name=domain]")?.content,O=new URLSearchParams(window.location.search),x=O.get("id")||1044,y="#gas-achievement";$(".ga-loader-container").show();$("#ga-sections-container").hide();$(async()=>{if(await auth0Bootstrap(),await T(y,token,w,x),await R(y,w,x)){await Promise.all([await H(y,w,x),await M(y,w,x)]),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$("#gas-wf-tab-activator").click();return}window.location.replace("/achievements")});})();
