(()=>{async function b(t,a,r,s){if($(`${t}-btn-guide-edit`).hide(),!a)return;let e=await fetch(`https://${r}/api/achievement/${s}/guide-auth-user-data`,{headers:{Authorization:`Bearer ${a}`}});if(e.status!==200)return;let c=await e.json();c?.ownedGuideId>0&&($(`${t}-btn-guide-create`).hide(),$(`${t}-btn-guide-edit`).attr("href",`/guide-form?id=${c.ownedGuideId}`).show())}var x=t=>{let a=new Date(t),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=`${a.getDate()} ${r[a.getMonth()]}, ${a.getFullYear()}`,e=a.toLocaleTimeString().toLowerCase();return{date:s,time:e}};var T=t=>t?.length?t.replace(/"(\w)/g,"\u201C$1").replace(/(\w)"/g,"$1\u201D").replaceAll('"',"'"):t;var L=t=>{if(t<25)return"common";if(t<50)return"rare";if(t<75)return"very-rare";if(t>=75)return"ultra-rare"},C=(t,a,r=".hero-section-achievement")=>{let s=a,e=L(t);return s=$(".rarity-tag-wrapper",s).children(`:not(.gas-rarity-tag-${e})`).hide().parents(r).prop("outerHTML"),s};var A=(t,a,r=".gas-list-entry")=>{let s=a,e={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return e.ps.rgx.test(t)&&(s=$(".gas-platform-psn",s).css("display","inherit").parents(r).prop("outerHTML")),e.steam.rgx.test(t)&&(s=$(".gas-platform-steam",s).css("display","inherit").parents(r).prop("outerHTML")),e.xbox.rgx.test(t)&&(s=$(".gas-platform-xbox",s).css("display","inherit").parents(r).prop("outerHTML")),s};var u=(t,a,r=".gas-list-entry")=>t.removeAttr("srcset").removeAttr("sizes").attr("src",a).parents(r).prop("outerHTML");function I({listsData:t,listResultsKey:a,elemId:r,textKeysToReplace:s}){console.info(`=== ${r} results ===`,t);let e=$(r),c=e.prop("outerHTML"),n=$(".gas-list-empty",e),p=e.children().first(),i=$(".gas-list-entry",e).first();e.html(p);let l=t[a];l?.length>0?(i.show(),e.append(i),c=i.prop("outerHTML"),i.hide(),l.forEach((h,f)=>{let o=c;for(let[m,d]of Object.entries(h)){let g=$(".gas-list-entry-cover",o);if(g?.length&&h.iconURL?.length&&(o=u(g,h.iconURL)||o),o=o.replaceAll("{|idx|}",f+1),m==="unlockedAt"){let{date:R,time:S}=x(d);o=o.replaceAll("{|unlockedDt|}",R||"N.A."),o=o.replaceAll(`{|${m}|}`,S||"N.A.")}else s.includes(m)&&(o=o.replaceAll(`{|${m}|}`,d||""))}e.append(o).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${f%2>0?"light":"dark"}`)})):(e.append(n),n.show()),e.show()}async function F({elemIdPrefix:t,apiDomain:a,achievementId:r},{listName:s,type:e,textKeysToReplace:c}){let n=`${t}-${s}-${e==="last"?"latest":e}`,i=await(await fetch(`https://${a}/api/achievement/${r}/${s}?type=${e}`)).json();I({listsData:i,listResultsKey:s,elemId:n,textKeysToReplace:c})}async function k(t,a,r){await F({elemIdPrefix:t,apiDomain:a,achievementId:r},{listName:"achievers",type:"first",textKeysToReplace:["name","profileId"]}),await F({elemIdPrefix:t,apiDomain:a,achievementId:r},{listName:"achievers",type:"last",textKeysToReplace:["name","profileId"]})}function j({listData:t,listResultsKey:a,elemId:r,numKeysToReplace:s,textKeysToReplace:e}){console.info(`=== ${r} results ===`,t);let c=$(r).prop("outerHTML"),n=$(`${r} .gas-list`),p=$(".gas-list-empty",n);if(t.count>0&&t[a]?.length){let i=n.children().first(),l=$(".gas-list-entry",n).first();l.show(),c=l.prop("outerHTML"),n.html(i).append(l),l.hide(),t[a].forEach((h,f)=>{let o=c;for(let[m,d]of Object.entries(h)){let g=$(".gas-list-entry-cover",o);g?.length&&h.iconURL?.length&&(o=u(g,h.iconURL)||o),e.includes(m)?o=o.replaceAll(`{|${m}|}`,T(d)||""):s.includes(m)&&(o=o.replaceAll(`{|${m}|}`,Math.round(d||0)))}n.append(o).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${f%2>0?"light":"dark"}`)})}else n.html(p),p.show();n.css("display","flex")}async function N({elemIdPrefix:t,apiDomain:a,achievementId:r},{listName:s,numKeysToReplace:e,textKeysToReplace:c}){let n=`${t}-${s}`,i=await(await fetch(`https://${a}/api/achievement/${r}/${s}`)).json();j({listData:i,listResultsKey:s,elemId:n,numKeysToReplace:e,textKeysToReplace:c})}async function M(t,a,r){await N({elemIdPrefix:t,apiDomain:a,achievementId:r},{listName:"guides",numKeysToReplace:["id","commentsCount","viewsCount","likesCount"],textKeysToReplace:["profileId","name","description","author"]})}function V(t,a){let r=`${t}-details`,s=$(r),e=s.prop("outerHTML");console.info(`=== ${r} ===`,a);let c=["id","name","description","gameId","gameName"],n=["achievers","completionPercentage","guides","gaPoints"],p=a.coverURL||a.imageURL||a.gameImageURL;p?.length&&(e=s.css("background-image",`linear-gradient(rgba(255,255,255,0),#030922),
          linear-gradient(rgba(70,89,255,.4),rgba(70,89,255,.4)),
          url(${p})`).prop("outerHTML")),$(".achievement-main-img",e).each((i,l)=>{a.imageURL?.length&&(e=u($(l),a.imageURL,r)||e)});for(let[i,l]of Object.entries(a))c.includes(i)?e=e.replaceAll(`{|${i}|}`,l):n.includes(i)?e=e.replaceAll(`{|${i}|}`,Math.round(l||0)):i==="platform"?e=A(l,e,r):i==="rarity"&&(e=C(l,e));s.prop("outerHTML",e)}async function H(t,a,r){let s=await fetch(`https://${a}/api/achievement/${r}`);if(s.status!==200)return;let e=await s.json();return Object.keys(e).length>0&&e.id&&(document.title=`${e.name?.length?e.name:e.id} | ${document.title}`,V(t,e)),e}var w=document.querySelector("meta[name=domain]")?.content,G=new URLSearchParams(window.location.search),y=G.get("id")||1044,v="#gas-achievement";$(".ga-loader-container").show();$("#ga-sections-container").hide();$(async()=>{if(await auth0Bootstrap(),await b(v,token,w,y),await H(v,w,y)){await Promise.all([await M(v,w,y),await k(v,w,y)]),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$("#gas-wf-tab-activator").click();return}window.location.replace("/achievements")});})();
