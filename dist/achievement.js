(()=>{var x=(t,e,n=".gas-list-entry")=>{let s={ps:{rgx:/playstation/gi},xbox:{rgx:/xbox/gi},steam:{rgx:/steam|pc|windows|mac|linux/gi}};return s.ps.rgx.test(t)&&(e=$(".gas-platform-psn",e).css("display","inherit").parents(n).prop("outerHTML")),s.steam.rgx.test(t)&&(e=$(".gas-platform-steam",e).css("display","inherit").parents(n).prop("outerHTML")),s.xbox.rgx.test(t)&&(e=$(".gas-platform-xbox",e).css("display","inherit").parents(n).prop("outerHTML")),e};var w=document.querySelector("meta[name=domain]")?.content,v=new URLSearchParams(window.location.search),y=v.get("id")||1044,d="#gas-achievement";$(".ga-loader-container").show();$("#ga-sections-container").hide();function R(t){let e=`${d}-details`,n=$(e),s=n.prop("outerHTML");console.info(`=== ${e} ===`,t);let r=["id","name","description","gameId","gameName"],o=["achievers","completionPercentage","guides","gaPoints"],i=t.coverURL||t.imageURL||t.gameImageURL;i?.length&&(s=n.css("background-image",`linear-gradient(rgba(255,255,255,0),#030922),
          linear-gradient(rgba(70,89,255,.4),rgba(70,89,255,.4)),
          url(${i})`).prop("outerHTML")),Object.entries(t).forEach(([c,l])=>{r.includes(c)?s=s.replaceAll(`{|${c}|}`,l):o.includes(c)?s=s.replaceAll(`{|${c}|}`,Math.round(l||0)):c==="platform"?s=x(l,s,e):c==="rarity"&&(s=showRarityTagAchievement(l,s))}),n.prop("outerHTML",s)}async function M(){let t=await fetch(`https://${w}/api/achievement/${y}`);if(t.status!==200)return;let e=await t.json();return Object.keys(e).length>0&&e.id&&(document.title=`${e.name?.length?e.name:e.id} | ${document.title}`,R(e)),e}function D({listData:t,listResultsKey:e,elemId:n,numKeysToReplace:s,textKeysToReplace:r}){console.info(`=== ${n} results ===`,t);let o=$(n).prop("outerHTML"),i=$(`${n} .gas-list`),c=$(".gas-list-empty",i);if(t.count>0&&t[e]?.length){let l=i.children().first(),p=$(".gas-list-entry",i).first();p.show(),o=p.prop("outerHTML"),i.html(l).append(p),p.hide(),t[e].forEach((g,f)=>{let a=o;Object.entries(g).forEach(([h,m])=>{let u=$(".gas-list-entry-cover",a);u?.length&&g.iconURL?.length&&(a=showImageFromSrc(u,g.iconURL)||a),r.includes(h)?a=a.replaceAll(`{|${h}|}`,cleanupDoubleQuotes(m)||""):s.includes(h)&&(a=a.replaceAll(`{|${h}|}`,Math.round(m||0)))}),i.append(a).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${f%2>0?"light":"dark"}`)})}else i.html(c),c.show();i.css("display","flex")}async function H({listName:t,numKeysToReplace:e,textKeysToReplace:n}){let s=`${d}-${t}`,o=await(await fetch(`https://${w}/api/achievement/${y}/${t}`)).json();D({listData:o,listResultsKey:t,elemId:s,numKeysToReplace:e,textKeysToReplace:n})}function A({listsData:t,listResultsKey:e,elemId:n,textKeysToReplace:s}){console.info(`=== ${n} results ===`,t);let r=$(n),o=r.prop("outerHTML"),i=$(".gas-list-empty",r),c=r.children().first(),l=$(".gas-list-entry",r).first();r.html(c);let p=t[e];p?.length>0?(l.show(),r.append(l),o=l.prop("outerHTML"),l.hide(),p.forEach((g,f)=>{let a=o;Object.entries(g).forEach(([h,m])=>{let u=$(".gas-list-entry-cover",a);if(u?.length&&g.iconURL?.length&&(a=showImageFromSrc(u,g.iconURL)||a),a=a.replaceAll("{|idx|}",f+1),h==="unlockedAt"){let{date:L,time:T}=gaDateTime(m);a=a.replaceAll("{|unlockedDt|}",L||"N.A."),a=a.replaceAll(`{|${h}|}`,T||"N.A.")}else s.includes(h)&&(a=a.replaceAll(`{|${h}|}`,m||""))}),r.append(a).children().last().removeClass(["bg-light","bg-dark"]).addClass(`bg-${f%2>0?"light":"dark"}`)})):(r.append(i),i.show()),r.show()}async function b({listName:t,type:e,textKeysToReplace:n}){let s=`${d}-${t}-${e==="last"?"latest":e}`,o=await(await fetch(`https://${w}/api/achievement/${y}/${t}?type=${e}`)).json();A({listsData:o,listResultsKey:t,elemId:s,textKeysToReplace:n})}async function C(){if($(`${d}-btn-guide-edit`).hide(),!token)return;let t=await fetch(`https://${w}/api/achievement/${y}/guide-auth-user-data`,{headers:{Authorization:`Bearer ${token}`}});if(t.status!==200)return;let e=await t.json();e?.ownedGuideId>0&&($(`${d}-btn-guide-create`).hide(),$(`${d}-btn-guide-edit`).attr("href",`/guide-form?id=${e.ownedGuideId}`).show())}$().ready(async()=>{if(await auth0Bootstrap(),await C(),await M()){await Promise.all([await H({listName:"guides",numKeysToReplace:["id","commentsCount","viewsCount","likesCount"],textKeysToReplace:["profileId","name","description","author"]}),await b({listName:"achievers",type:"first",textKeysToReplace:["name","profileId"]}),await b({listName:"achievers",type:"last",textKeysToReplace:["name","profileId"]})]),$(".ga-loader-container").hide(),$("#ga-sections-container").show(),$("#gas-wf-tab-activator").click();return}window.location.replace("/achievements")});})();
